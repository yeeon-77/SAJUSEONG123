// API í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”
const OPENAI_API_KEY = 'your-openai-api-key-here';

const form = document.getElementById('sajuForm');
const loading = document.getElementById('loading');
const resultSection = document.getElementById('resultSection');
const errorMessage = document.getElementById('errorMessage');
const analyzeBtn = document.getElementById('analyzeBtn');
const timeUnknownCheckbox = document.getElementById('timeUnknown');
const timeSelect = document.getElementById('timeSelect');
const partnerTimeUnknownCheckbox = document.getElementById('partnerTimeUnknown');
const partnerTimeSelect = document.getElementById('partnerTimeSelect');
const dayInput = document.getElementById('day');
const monthSelect = document.getElementById('month');

const heavenlyStems = ['ê°‘','ì„','ë³‘','ì •','ë¬´','ê¸°','ê²½','ì‹ ','ì„','ê³„'];
const earthlyBranches = ['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'];

// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
function loadUserInfo() {
  const savedUser = localStorage.getItem('sajuUser');
  if (savedUser) {
    const user = JSON.parse(savedUser);
    document.getElementById('name').value = user.name || '';
    document.getElementById('gender').value = user.gender || '';
    document.getElementById('year').value = user.year || '';
    document.getElementById('month').value = user.month || '';
    document.getElementById('day').value = user.day || '';
    if (user.hour) {
      document.getElementById('hour').value = user.hour;
    } else {
      timeUnknownCheckbox.checked = true;
      timeSelect.style.display = 'none';
    }
    
    // ì €ì¥ëœ ì •ë³´ê°€ ìˆìœ¼ë©´ ë‹¤ë¥¸ íƒ­ë“¤ í™œì„±í™”
    updateTabsBasedOnUserInfo(user);
  }
}

// ì‚¬ìš©ì ì •ë³´ì— ë”°ë¼ íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
function updateTabsBasedOnUserInfo(user) {
  if (user && user.name && user.gender && user.year && user.month && user.day) {
    // ì—°ì• ìš´ íƒ­ í™œì„±í™”
    const loveFortuneNotice = document.getElementById('loveFortuneNotice');
    if (loveFortuneNotice) {
      loveFortuneNotice.innerHTML = `<p>ğŸ’– ${user.name}ë‹˜ì˜ ì—°ì• ìš´ì„ í™•ì¸í•´ë³´ì„¸ìš”!</p>`;
    }
    
    // ê¶í•© íƒ­ í™œì„±í™”
    const compatibilityNotice = document.getElementById('compatibilityNotice');
    if (compatibilityNotice) {
      compatibilityNotice.innerHTML = `<p>ğŸ’• ${user.name}ë‹˜ì˜ ê¶í•©ì„ ë¶„ì„í•´ë³´ì„¸ìš”!</p>`;
    }
    
    // í”„ë¦¬ë¯¸ì—„ íƒ­ í™œì„±í™”
    const premiumNotice = document.getElementById('premiumNotice');
    if (premiumNotice) {
      premiumNotice.innerHTML = `<p>âœ¨ ${user.name}ë‹˜ì„ ìœ„í•œ í”„ë¦¬ë¯¸ì—„ ì—°ì•  ë¶„ì„!</p>`;
    }
    
    // ì—°ì• ìš´ ë¶„ì„ ë²„íŠ¼ë“¤ í‘œì‹œ
    document.getElementById('dailyAnalyzeBtn').style.display = 'block';
    document.getElementById('monthlyAnalyzeBtn').style.display = 'block';
    document.getElementById('yearlyAnalyzeBtn').style.display = 'block';
    
    // í”„ë¦¬ë¯¸ì—„ ë¶„ì„ ë²„íŠ¼ë“¤ í‘œì‹œ (ê²°ì œ í›„ì—ë§Œ)
    if (localStorage.getItem('premiumPaid') === 'true') {
      document.getElementById('futureAnalyzeBtn').style.display = 'block';
      document.getElementById('thinkingAnalyzeBtn').style.display = 'block';
      document.getElementById('marriageAnalyzeBtn').style.display = 'block';
      document.getElementById('strategyAnalyzeBtn').style.display = 'block';
      document.getElementById('soulmateAnalyzeBtn').style.display = 'block';
      document.getElementById('timingAnalyzeBtn').style.display = 'block';
    }
    
    // ë§ˆìŒ ì½ê¸° ë²„íŠ¼ë“¤ í™œì„±í™”
    document.querySelectorAll('.mind-btn').forEach(btn => {
      btn.disabled = false;
    });
  }
}

// ì‚¬ìš©ì ì •ë³´ ì €ì¥
function saveUserInfo(name, gender, year, month, day, hour) {
  const userInfo = { name, gender, year, month, day, hour };
  localStorage.setItem('sajuUser', JSON.stringify(userInfo));
  updateTabsBasedOnUserInfo(userInfo);
}

// íƒœì–´ë‚œ ì‹œê°„ ëª¨ë¦„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
timeUnknownCheckbox.addEventListener('change', function() {
  if (this.checked) {
    timeSelect.style.display = 'none';
    document.getElementById('hour').value = '';
  } else {
    timeSelect.style.display = 'block';
  }
});

partnerTimeUnknownCheckbox.addEventListener('change', function() {
  if (this.checked) {
    partnerTimeSelect.style.display = 'none';
    document.getElementById('partnerHour').value = '';
  } else {
    partnerTimeSelect.style.display = 'block';
  }
});

// ì›”ë³„ ì¼ìˆ˜ ì œí•œ
monthSelect.addEventListener('change', updateDayLimit);
function updateDayLimit() {
  const month = parseInt(monthSelect.value);
  const year = parseInt(document.getElementById('year').value);
  
  if (month) {
    let maxDay = 31;
    if ([4, 6, 9, 11].includes(month)) {
      maxDay = 30;
    } else if (month === 2) {
      maxDay = isLeapYear(year) ? 29 : 28;
    }
    dayInput.max = maxDay;
    
    if (parseInt(dayInput.value) > maxDay) {
      dayInput.value = maxDay;
    }
  }
}

function isLeapYear(year) {
  return year && ((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0);
}

function mod(n, m){ 
  return ((n % m) + m) % m; 
}

function calculateSaju(year, month, day, hour = null){
  const yearStem = heavenlyStems[mod(year - 4, 10)];
  const yearBranch = earthlyBranches[mod(year - 4, 12)];
  const monthStem = heavenlyStems[mod(month - 1, 10)];
  const monthBranch = earthlyBranches[mod(month - 1, 12)];
  const dayStem = heavenlyStems[mod(day, 10)];
  const dayBranch = earthlyBranches[mod(day, 12)];

  let timeStem = '-';
  let timeBranch = '-';
  
  if (hour !== null) {
    const hourIndex = Math.floor(mod(hour + 1, 24) / 2);
    timeBranch = earthlyBranches[hourIndex];
    timeStem = heavenlyStems[hourIndex % 10];
  }

  return { 
    year: yearStem + yearBranch, 
    month: monthStem + monthBranch, 
    day: dayStem + dayBranch, 
    time: hour !== null ? timeStem + timeBranch : 'ì‹œê°„ë¯¸ìƒ'
  };
}

async function callOpenAI(prompt, systemMessage = 'ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ì‚¬ì£¼ ë¶„ì„ê°€ì…ë‹ˆë‹¤.') {
  if (OPENAI_API_KEY && OPENAI_API_KEY !== 'your-openai-api-key-here') {
    try {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: 'gpt-3.5-turbo',
          messages: [
            { role: 'system', content: systemMessage },
            { role: 'user', content: prompt }
          ],
          max_tokens: 1500,
          temperature: 0.7
        })
      });

      if (response.ok) {
        const data = await response.json();
        return data.choices[0].message.content;
      } else {
        throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
      }
    } catch (error) {
      console.error('OpenAI API ì˜¤ë¥˜:', error);
      return null;
    }
  }
  return null;
}

// ë‚´ì‚¬ì£¼ ë¶„ì„
async function analyzeBasicPersonality(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì˜ ê¸°ë³¸ ì„±ê²©ì„ ì‚¬ì£¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ê¸°ë³¸ ì„±ê²©ê³¼ ê¸°ì§ˆ
2. ì¥ì ê³¼ ê°•ì 
3. ë‹¨ì ê³¼ ì£¼ì˜í•  ì 
4. ëŒ€ì¸ê´€ê³„ ìŠ¤íƒ€ì¼
5. ì„±ê²© ê°œì„  ë°©í–¥`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ì‚¬ì£¼ ì„±ê²© ë¶„ì„ê°€ì…ë‹ˆë‹¤.');
  
  return result || `ğŸŒŸ **${name}ë‹˜ì˜ ê¸°ë³¸ ì„±ê²© ë¶„ì„**

**ğŸ’« ê¸°ë³¸ ì„±ê²©ê³¼ ê¸°ì§ˆ**
${saju.day}ì¼ì£¼ë¥¼ ê°€ì§„ ${name}ë‹˜ì€ ë”°ëœ»í•˜ê³  ë°°ë ¤ì‹¬ì´ ë§ì€ ì„±ê²©ì…ë‹ˆë‹¤. ê°ì •ì´ í’ë¶€í•˜ê³  ì§ê´€ë ¥ì´ ë›°ì–´ë‚˜ë©°, ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ì•ˆì •ê°ì„ ì£¼ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.

**âœ¨ ì¥ì ê³¼ ê°•ì **
- ë›°ì–´ë‚œ ê³µê° ëŠ¥ë ¥ê³¼ ì†Œí†µ ì‹¤ë ¥
- ì±…ì„ê°ì´ ê°•í•˜ê³  ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì„±ê²©
- ì°½ì˜ì ì´ê³  ì˜ˆìˆ ì  ê°ê°ì´ ë›°ì–´ë‚¨
- ì–´ë ¤ìš´ ìƒí™©ì—ì„œë„ ê¸ì •ì  ë§ˆì¸ë“œ ìœ ì§€

**âš ï¸ ë‹¨ì ê³¼ ì£¼ì˜í•  ì **
- ë•Œë¡œëŠ” ë„ˆë¬´ ê°ì •ì ìœ¼ë¡œ íŒë‹¨í•˜ëŠ” ê²½í–¥
- ì™„ë²½ì£¼ì˜ ì„±í–¥ìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ê¸° ì‰¬ì›€
- íƒ€ì¸ì˜ ì‹œì„ ì„ ì§€ë‚˜ì¹˜ê²Œ ì˜ì‹í•˜ëŠ” ë©´

**ğŸ‘¥ ëŒ€ì¸ê´€ê³„ ìŠ¤íƒ€ì¼**
ì§„ì‹¤í•˜ê³  ë”°ëœ»í•œ ê´€ê³„ë¥¼ ì„ í˜¸í•˜ë©°, ê¹Šì´ ìˆëŠ” ìš°ì •ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤. ë¦¬ë”ì‹­ë³´ë‹¤ëŠ” ì¡°í™”ë¡œìš´ ë¶„ìœ„ê¸° ì¡°ì„±ì— íƒì›”í•©ë‹ˆë‹¤.

**ğŸ¯ ì„±ê²© ê°œì„  ë°©í–¥**
ìì‹ ì˜ ê°ì •ì„ ê°ê´€ì ìœ¼ë¡œ ë°”ë¼ë³´ëŠ” ì—°ìŠµê³¼ í•¨ê»˜, ë•Œë¡œëŠ” ê³¼ê°í•œ ê²°ë‹¨ë ¥ì„ ê¸°ë¥´ëŠ” ê²ƒì´ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.`;
}

async function analyzeCareer(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì˜ ì§ì—…ìš´ì„ ì‚¬ì£¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ì ì„±ì— ë§ëŠ” ì§ì—… ë¶„ì•¼
2. ì§ì¥ì—ì„œì˜ ì„±ê³µ ê°€ëŠ¥ì„±
3. ì°½ì—… vs ì§ì¥ìƒí™œ ì í•©ì„±
4. ìŠ¹ì§„ ë° ë°œì „ ì‹œê¸°
5. ì§ì—… ì„±ê³µì„ ìœ„í•œ ì¡°ì–¸`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ì§ì—…ìš´ ë¶„ì„ê°€ì…ë‹ˆë‹¤.');
  
  return result || `ğŸ’¼ **${name}ë‹˜ì˜ ì§ì—…ìš´ ë¶„ì„**

**ğŸ¯ ì ì„±ì— ë§ëŠ” ì§ì—… ë¶„ì•¼**
ì°½ì˜ì„±ê³¼ ì†Œí†µ ëŠ¥ë ¥ì„ í™œìš©í•  ìˆ˜ ìˆëŠ” ë¶„ì•¼ê°€ ì í•©í•©ë‹ˆë‹¤. êµìœ¡, ìƒë‹´, ë§ˆì¼€íŒ…, ë””ìì¸, ë¬¸í™”ì˜ˆìˆ  ë¶„ì•¼ì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ë‚¼ ê²ƒì…ë‹ˆë‹¤.

**ğŸ“ˆ ì§ì¥ì—ì„œì˜ ì„±ê³µ ê°€ëŠ¥ì„±**
íŒ€ì›Œí¬ë¥¼ ì¤‘ì‹œí•˜ê³  ì¡°í™”ë¡œìš´ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“œëŠ” ëŠ¥ë ¥ìœ¼ë¡œ ë™ë£Œë“¤ì˜ ì‹ ë¢°ë¥¼ ì–»ì„ ê²ƒì…ë‹ˆë‹¤. ì¤‘ê°„ ê´€ë¦¬ì§ì—ì„œ íŠ¹íˆ ëŠ¥ë ¥ì„ ë°œíœ˜í•  ê²ƒì…ë‹ˆë‹¤.

**ğŸ¢ ì°½ì—… vs ì§ì¥ìƒí™œ ì í•©ì„±**
ì•ˆì •ì ì¸ ì§ì¥ìƒí™œì´ ë” ì í•©í•˜ì§€ë§Œ, ì°½ì˜ì ì¸ ë¶„ì•¼ì—ì„œì˜ ì°½ì—…ë„ ì„±ê³µ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

**â° ìŠ¹ì§„ ë° ë°œì „ ì‹œê¸°**
30ëŒ€ ì¤‘ë°˜ê³¼ 40ëŒ€ ì´ˆë°˜ì´ ì§ì—…ì  ë°œì „ì˜ í™©ê¸ˆê¸°ê°€ ë  ê²ƒì…ë‹ˆë‹¤.

**ğŸ’¡ ì§ì—… ì„±ê³µì„ ìœ„í•œ ì¡°ì–¸**
ê¾¸ì¤€í•œ ìê¸°ê³„ë°œê³¼ ì¸ë§¥ ê´€ë¦¬ê°€ ì„±ê³µì˜ ì—´ì‡ ì…ë‹ˆë‹¤.`;
}

// ì—°ì• ìš´ ë¶„ì„
async function analyzeLoveFortune(name, gender, saju, type = 'daily') {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const today = new Date();
  const currentMonth = today.getMonth() + 1;
  const currentYear = today.getFullYear();
  
  let prompt = '';
  
  switch(type) {
    case 'daily':
      prompt = `${name}ë‹˜(${genderText})ì˜ ì˜¤ëŠ˜ ì—°ì• ìš´ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ì˜¤ëŠ˜(${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼)ì˜ ì—°ì• ìš´ì„ ë‹¤ìŒ í•­ëª©ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ì˜¤ëŠ˜ì˜ ì—°ì•  ìš´ì„¸ ì ìˆ˜ (100ì  ë§Œì )
2. ìƒˆë¡œìš´ ë§Œë‚¨ì˜ ê°€ëŠ¥ì„±
3. ê¸°ì¡´ ì—°ì¸ê³¼ì˜ ê´€ê³„
4. ê³ ë°±í•˜ê¸° ì¢‹ì€ ì‹œê°„ëŒ€
5. í”¼í•´ì•¼ í•  í–‰ë™
6. ì—°ì• ìš´ ìƒìŠ¹ íŒ`;
      break;
      
    case 'monthly':
      prompt = `${name}ë‹˜(${genderText})ì˜ ì´ë²ˆ ë‹¬(${currentYear}ë…„ ${currentMonth}ì›”) ì—°ì• ìš´ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ì´ë²ˆ ë‹¬ì˜ ì—°ì• ìš´ì„ ë‹¤ìŒ í•­ëª©ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ì´ë‹¬ì˜ ì „ì²´ì ì¸ ì—°ì• ìš´
2. ì—°ì• ìš´ì´ ì¢‹ì€ ë‚ ì§œë“¤
3. ìƒˆë¡œìš´ ì¸ì—°ì„ ë§Œë‚  ê°€ëŠ¥ì„±
4. ê¸°ì¡´ ê´€ê³„ì˜ ë°œì „ ë°©í–¥
5. ì£¼ì˜í•´ì•¼ í•  ì‹œê¸°
6. ì´ë‹¬ì˜ ì—°ì•  ì¡°ì–¸`;
      break;
      
    case 'yearly':
      prompt = `${name}ë‹˜(${genderText})ì˜ ì˜¬í•´(${currentYear}ë…„) ì—°ì• ìš´ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ì˜¬í•´ì˜ ì—°ì• ìš´ì„ ë‹¤ìŒ í•­ëª©ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ì˜¬í•´ ì „ì²´ì ì¸ ì—°ì• ìš´ íë¦„
2. ì—°ì• ìš´ì´ ì¢‹ì€ ê³„ì ˆ/ì›”
3. ê²°í˜¼ ê°€ëŠ¥ì„± ë° ì‹œê¸°
4. ì´ë³„ ìœ„í—˜ ì‹œê¸°
5. ìƒˆë¡œìš´ ì‚¬ë‘ì˜ ì‹œì‘ ì‹œê¸°
6. ì˜¬í•´ ì—°ì•  ì„±ê³µ ì „ëµ`;
      break;
  }

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ì—°ì•  ì‚¬ì£¼ ë¶„ì„ê°€ì…ë‹ˆë‹¤.');
  
  if (result) return result;
  
  // ë°ëª¨ ë¶„ì„
  const demoResponses = {
    daily: `ğŸ’– **${name}ë‹˜ì˜ ì˜¤ëŠ˜ ì—°ì• ìš´**

**âœ¨ ì˜¤ëŠ˜ì˜ ì—°ì•  ìš´ì„¸ ì ìˆ˜: 85ì **
${saju.day}ì¼ì£¼ë¥¼ ê°€ì§„ ${name}ë‹˜, ì˜¤ëŠ˜ì€ ì—°ì• ìš´ì´ ìƒë‹¹íˆ ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤!

**ğŸ’• ìƒˆë¡œìš´ ë§Œë‚¨ì˜ ê°€ëŠ¥ì„±**
ì˜¤í›„ 2ì‹œ~6ì‹œ ì‚¬ì´ì— íŠ¹ë³„í•œ ì¸ì—°ì„ ë§Œë‚  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

**ğŸ’‘ ê¸°ì¡´ ì—°ì¸ê³¼ì˜ ê´€ê³„**
ì†Œí†µì´ ì›í™œí•œ í•˜ë£¨ì…ë‹ˆë‹¤. ì§„ì†”í•œ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ë©´ ê´€ê³„ê°€ í•œì¸µ ê¹Šì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤.

**ğŸ• ê³ ë°±í•˜ê¸° ì¢‹ì€ ì‹œê°„ëŒ€**
ì €ë… 7ì‹œ~9ì‹œê°€ ê³ ë°±í•˜ê¸°ì— ê°€ì¥ ì¢‹ì€ ì‹œê°„ì…ë‹ˆë‹¤.

**âš ï¸ í”¼í•´ì•¼ í•  í–‰ë™**
ê³¼ë„í•œ ì§ˆíˆ¬ë‚˜ ì˜ì‹¬ì€ ê¸ˆë¬¼ì…ë‹ˆë‹¤.

**ğŸŒŸ ì—°ì• ìš´ ìƒìŠ¹ íŒ**
ë¶„í™ìƒ‰ì´ë‚˜ ì—°í•œ íŒŒë€ìƒ‰ ì˜·ì„ ì…ìœ¼ë©´ ë§¤ë ¥ì´ ë”ìš± ë¹›ë‚  ê²ƒì…ë‹ˆë‹¤!`,

    monthly: `ğŸŒ™ **${name}ë‹˜ì˜ ì´ë‹¬ ì—°ì• ìš´**

**ğŸ’– ì´ë‹¬ì˜ ì „ì²´ì ì¸ ì—°ì• ìš´**
${saju.month}ì›”ì£¼ì˜ ì˜í–¥ìœ¼ë¡œ ì´ë²ˆ ë‹¬ì€ ê°ì •ì ìœ¼ë¡œ í’ìš”ë¡œìš´ ì‹œê¸°ì…ë‹ˆë‹¤.

**ğŸ“… ì—°ì• ìš´ì´ ì¢‹ì€ ë‚ ì§œë“¤**
${today.getDate() + 3}ì¼, ${today.getDate() + 10}ì¼, ${today.getDate() + 17}ì¼ì´ íŠ¹íˆ ì¢‹ìŠµë‹ˆë‹¤.

**âœ¨ ìƒˆë¡œìš´ ì¸ì—°ì„ ë§Œë‚  ê°€ëŠ¥ì„±**
ì´ë‹¬ ì¤‘ìˆœ ì´í›„ ìƒˆë¡œìš´ ì¸ì—°ì´ ì°¾ì•„ì˜¬ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.`,

    yearly: `â­ **${name}ë‹˜ì˜ ì˜¬í•´ ì—°ì• ìš´**

**ğŸŒŸ ì˜¬í•´ ì „ì²´ì ì¸ ì—°ì• ìš´ íë¦„**
${saju.year}ë…„ì£¼ì˜ ê¸°ìš´ìœ¼ë¡œ ì˜¬í•´ëŠ” ì—°ì• ì— ìˆì–´ ë³€í™”ì™€ ì„±ì¥ì˜ í•´ì…ë‹ˆë‹¤.

**ğŸŒ¸ ì—°ì• ìš´ì´ ì¢‹ì€ ê³„ì ˆ/ì›”**
ë´„(3-5ì›”)ê³¼ ê°€ì„(9-11ì›”)ì´ íŠ¹íˆ ì¢‹ìŠµë‹ˆë‹¤.

**ğŸ’’ ê²°í˜¼ ê°€ëŠ¥ì„± ë° ì‹œê¸°**
í•˜ë°˜ê¸°ì— ê²°í˜¼ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ì§„ì§€í•œ ë§Œë‚¨ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤.`
  };
  
  return demoResponses[type] || 'ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...';
}

// ê¶í•© ë¶„ì„
async function analyzeCompatibility(user, partner) {
  const userSaju = calculateSaju(user.year, user.month, user.day, user.hour);
  const partnerSaju = calculateSaju(partner.year, partner.month, partner.day, partner.hour);
  
  const prompt = `${user.name}ë‹˜(${user.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'})ê³¼ ${partner.name}ë‹˜(${partner.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'})ì˜ ê¶í•©ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.

${user.name}ë‹˜ ì‚¬ì£¼: ë…„ì£¼(${userSaju.year}) ì›”ì£¼(${userSaju.month}) ì¼ì£¼(${userSaju.day}) ì‹œì£¼(${userSaju.time})
${partner.name}ë‹˜ ì‚¬ì£¼: ë…„ì£¼(${partnerSaju.year}) ì›”ì£¼(${partnerSaju.month}) ì¼ì£¼(${partnerSaju.day}) ì‹œì£¼(${partnerSaju.time})

ë‹¤ìŒ í•­ëª©ìœ¼ë¡œ ê¶í•©ì„ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ì „ì²´ì ì¸ ê¶í•© ì ìˆ˜ (100ì  ë§Œì )
2. ì„±ê²©ì  ê¶í•©
3. ì—°ì•  ìŠ¤íƒ€ì¼ ê¶í•©
4. ê²°í˜¼ ê¶í•©
5. ì„œë¡œ ë³´ì™„í•´ì£¼ëŠ” ì 
6. ì£¼ì˜í•´ì•¼ í•  ì 
7. ê´€ê³„ ë°œì „ì„ ìœ„í•œ ì¡°ì–¸`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ê¶í•© ë¶„ì„ê°€ì…ë‹ˆë‹¤.');
  
  return result || `ğŸ’• **${user.name}ë‹˜ê³¼ ${partner.name}ë‹˜ì˜ ê¶í•© ë¶„ì„**

**ğŸ’¯ ì „ì²´ì ì¸ ê¶í•© ì ìˆ˜: 82ì **

**ğŸ‘« ì„±ê²©ì  ê¶í•©**
ë‘ ë¶„ì€ ì„œë¡œ ë‹¤ë¥¸ ë§¤ë ¥ì„ ê°€ì§€ê³  ìˆì–´ ìƒí˜¸ ë³´ì™„ì ì¸ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ğŸ’– ì—°ì•  ìŠ¤íƒ€ì¼ ê¶í•©**
${user.name}ë‹˜ì˜ ë”°ëœ»í•œ ì„±ê²©ê³¼ ${partner.name}ë‹˜ì˜ ì§„ì¤‘í•¨ì´ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.

**ğŸ’’ ê²°í˜¼ ê¶í•©**
ì¥ê¸°ì ìœ¼ë¡œ ì•ˆì •ì ì¸ ê´€ê³„ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ì¢‹ì€ ê¶í•©ì…ë‹ˆë‹¤.

**ğŸŒŸ ì„œë¡œ ë³´ì™„í•´ì£¼ëŠ” ì **
${user.name}ë‹˜ì€ ${partner.name}ë‹˜ì—ê²Œ í™œë ¥ì„, ${partner.name}ë‹˜ì€ ${user.name}ë‹˜ì—ê²Œ ì•ˆì •ê°ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**âš ï¸ ì£¼ì˜í•´ì•¼ í•  ì **
ê°€ë” ì˜ì‚¬ì†Œí†µì—ì„œ ì˜¤í•´ê°€ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë‹ˆ ì¶©ë¶„í•œ ëŒ€í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.

**ğŸ’ ê´€ê³„ ë°œì „ì„ ìœ„í•œ ì¡°ì–¸**
ì„œë¡œì˜ ì°¨ì´ì ì„ ì¸ì •í•˜ê³  ì¡´ì¤‘í•˜ëŠ” ë§ˆìŒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.`;
}

// ë§ˆìŒ ì½ê¸° ë¶„ì„
async function analyzeMindReading(name, gender, saju, type) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  let prompt = '';
  
  switch(type) {
    case 'thinking':
      prompt = `${name}ë‹˜(${genderText})ì´ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì´ ${name}ë‹˜ì„ ìƒê°í•˜ê³  ìˆëŠ”ì§€ ì‚¬ì£¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})`;
      break;
    case 'feelings':
      prompt = `${name}ë‹˜(${genderText})ì´ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì˜ ì†ë§ˆìŒì„ ì‚¬ì£¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})`;
      break;
    case 'future':
      prompt = `${name}ë‹˜(${genderText})ê³¼ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì˜ ë¯¸ë˜ë¥¼ ì‚¬ì£¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})`;
      break;
    case 'contact':
      prompt = `${name}ë‹˜(${genderText})ì—ê²Œ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒìœ¼ë¡œë¶€í„° ì—°ë½ì´ ì˜¬ì§€ ì‚¬ì£¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})`;
      break;
  }

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ë§ˆìŒì„ ì½ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ì£¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒëŒ€ë°©ì˜ ë§ˆìŒì„ ë”°ëœ»í•˜ê³  í¬ë§ì ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”.');
  
  if (result) return result;
  
  const responses = {
    thinking: `ğŸ’­ **ê·¸ ì‚¬ëŒì´ ${name}ë‹˜ì„ ìƒê°í•˜ê³  ìˆì„ê¹Œìš”?**

ë„¤, ê·¸ ì‚¬ëŒë„ ${name}ë‹˜ì„ ìì£¼ ìƒê°í•˜ê³  ìˆìŠµë‹ˆë‹¤! 
íŠ¹íˆ ì¡°ìš©í•œ ì‹œê°„ì— ${name}ë‹˜ê³¼ì˜ ì¶”ì–µì„ ë– ì˜¬ë¦¬ë©° ë¯¸ì†Œ ì§“ê³  ìˆì„ ê±°ì˜ˆìš”.`,
    
    feelings: `ğŸ’ **ê·¸ ì‚¬ëŒì˜ ì†ë§ˆìŒ**

ê·¸ ì‚¬ëŒì€ ${name}ë‹˜ì— ëŒ€í•´ íŠ¹ë³„í•œ ê°ì •ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
ì•„ì§ í‘œí˜„í•˜ì§€ ëª»í•˜ê³  ìˆì§€ë§Œ, ${name}ë‹˜ê³¼ í•¨ê»˜ ìˆì„ ë•Œ í¸ì•ˆí•¨ê³¼ í–‰ë³µì„ ëŠë¼ê³  ìˆì–´ìš”.`,
    
    future: `ğŸ”® **${name}ë‹˜ê³¼ ê·¸ ì‚¬ëŒì˜ ë¯¸ë˜**

ë‘ ë¶„ì˜ ë¯¸ë˜ëŠ” ë°ìŠµë‹ˆë‹¤! 
ì„œë¡œì— ëŒ€í•œ ì´í•´ê°€ ê¹Šì–´ì§€ë©´ì„œ ë”ìš± ê°€ê¹Œì›Œì§ˆ ê²ƒì´ê³ ,
ì§„ì‹¤í•œ ì‚¬ë‘ìœ¼ë¡œ ë°œì „í•  ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.`,

    contact: `ğŸ“± **ì—°ë½ì´ ì˜¬ê¹Œìš”?**

ê³§ ì¢‹ì€ ì†Œì‹ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤!
${name}ë‹˜ì„ ê·¸ë¦¬ì›Œí•˜ëŠ” ë§ˆìŒì´ ì»¤ì ¸ì„œ ë¨¼ì € ì—°ë½ì„ ì·¨í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
ì¡°ê¸ˆë§Œ ë” ê¸°ë‹¤ë ¤ë³´ì„¸ìš”.`
  };
  
  return responses[type] || 'ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...';
}

// í”„ë¦¬ë¯¸ì—„ ë¶„ì„ í•¨ìˆ˜ë“¤
async function analyzeFuture(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì´ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒê³¼ì˜ ë¯¸ë˜ë¥¼ ìƒì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ì„ 1000ì ì´ìƒìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ê·¸ ì‚¬ëŒê³¼ì˜ ê´€ê³„ ë°œì „ ê°€ëŠ¥ì„±ê³¼ ë‹¨ê³„ë³„ ê³¼ì •
2. ì–¸ì œì¯¤ ê´€ê³„ê°€ ì§„ì „ë ì§€ êµ¬ì²´ì ì¸ ì‹œê¸°
3. ë‘ ì‚¬ëŒì´ í•¨ê»˜í–ˆì„ ë•Œì˜ ëª¨ìŠµê³¼ ì¼ìƒ
4. ê·¹ë³µí•´ì•¼ í•  ì¥ì• ë¬¼ê³¼ í•´ê²° ë°©ë²•
5. ì¥ê¸°ì ì¸ ê´€ê³„ ìœ ì§€ ê°€ëŠ¥ì„±
6. ê²°í˜¼ê¹Œì§€ ì´ì–´ì§ˆ ê°€ëŠ¥ì„±ê³¼ ì‹œê¸°
7. êµ¬ì²´ì ì¸ í–‰ë™ ì§€ì¹¨ê³¼ ì¡°ì–¸

ì—°ì• ë¥¼ ê³ ë¯¼í•˜ëŠ” ì‚¬ëŒì˜ ë§ˆìŒì„ ì´í•´í•˜ê³  ì§„ì‹¬ì–´ë¦° ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ 30ë…„ ê²½ë ¥ì˜ ì „ë¬¸ ì—°ì•  ìƒë‹´ì‚¬ì´ì ì‚¬ì£¼ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì—°ì• ë¡œ ê³ ë¯¼í•˜ëŠ” ì‚¬ëŒë“¤ì—ê²Œ ë”°ëœ»í•˜ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.');
  
  return result || `ğŸ’• **${name}ë‹˜ê³¼ ê·¸ ì‚¬ëŒì˜ ë¯¸ë˜**

${name}ë‹˜ì˜ ì‚¬ì£¼ë¥¼ ê¹Šì´ ë¶„ì„í•œ ê²°ê³¼, ê·¸ ì‚¬ëŒê³¼ì˜ ë¯¸ë˜ëŠ” ë§¤ìš° ë°ê³  í¬ë§ì ì…ë‹ˆë‹¤. ${saju.day}ì¼ì£¼ë¥¼ ê°€ì§„ ${name}ë‹˜ì€ ì§„ì‹¤í•œ ì‚¬ë‘ì„ ì¶”êµ¬í•˜ëŠ” ì„±í–¥ì´ ê°•í•˜ë©°, ì´ëŠ” ìƒëŒ€ë°©ì—ê²Œë„ ê¹Šì€ ê°ë™ì„ ì¤„ ê²ƒì…ë‹ˆë‹¤.

**ğŸŒŸ ê´€ê³„ ë°œì „ ë‹¨ê³„**
í˜„ì¬ ë‘ ë¶„ì˜ ê´€ê³„ëŠ” ì„œë¡œì— ëŒ€í•œ í˜¸ê°ì´ ì‹¹íŠ¸ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì•ìœ¼ë¡œ 3-6ê°œì›” ë‚´ì— ë”ìš± ê°€ê¹Œì›Œì§ˆ ê¸°íšŒê°€ ë§ì´ ìƒê¸¸ ê²ƒì´ë©°, íŠ¹íˆ ê°€ì„ì² (9-11ì›”)ì— ê²°ì •ì ì¸ ìˆœê°„ì´ ì°¾ì•„ì˜¬ ê²ƒì…ë‹ˆë‹¤. ${name}ë‹˜ì˜ ë”°ëœ»í•˜ê³  ë°°ë ¤ì‹¬ ë§ì€ ì„±ê²©ì´ ìƒëŒ€ë°©ì˜ ë§ˆìŒì„ ì„œì„œíˆ ë…¹ì¼ ê²ƒì…ë‹ˆë‹¤.

**ğŸ’– í•¨ê»˜í•˜ëŠ” ì¼ìƒì˜ ëª¨ìŠµ**
ë‘ ë¶„ì´ ì—°ì¸ì´ ë˜ë©´ ë§¤ìš° ì¡°í™”ë¡œìš´ ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°ˆ ê²ƒì…ë‹ˆë‹¤. ${name}ë‹˜ì€ ìƒëŒ€ë°©ì—ê²Œ ì•ˆì •ê°ê³¼ ë”°ëœ»í•¨ì„ ì£¼ê³ , ìƒëŒ€ë°©ì€ ${name}ë‹˜ì—ê²Œ ìƒˆë¡œìš´ ìê·¹ê³¼ ì„±ì¥ì˜ ê¸°íšŒë¥¼ ì œê³µí•  ê²ƒì…ë‹ˆë‹¤. í•¨ê»˜ ì¹´í˜ì—ì„œ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê±°ë‚˜, ì‚°ì±…ì„ í•˜ë©° ì†Œì†Œí•œ í–‰ë³µì„ ë‚˜ëˆ„ëŠ” ëª¨ìŠµì´ ìì£¼ ë³´ì…ë‹ˆë‹¤.

**âš ï¸ ê·¹ë³µí•´ì•¼ í•  ê³¼ì œ**
${name}ë‹˜ì€ ë•Œë•Œë¡œ ìì‹ ì˜ ê°ì •ì„ í‘œí˜„í•˜ëŠ” ê²ƒì„ ì–´ë ¤ì›Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ì¶©ë¶„íˆ ê·¹ë³µ ê°€ëŠ¥í•œ ë¶€ë¶„ì…ë‹ˆë‹¤. ìƒëŒ€ë°©ê³¼ì˜ ì†Œí†µì—ì„œ ë”ìš± ì†”ì§í•´ì§€ê³ , ìì‹ ì˜ ë§ˆìŒì„ ì§„ì‹¤í•˜ê²Œ ì „ë‹¬í•˜ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.

**ğŸ’’ ê²°í˜¼ ê°€ëŠ¥ì„±**
ë‘ ë¶„ì˜ ê¶í•©ì„ ë³¼ ë•Œ, ê²°í˜¼ìœ¼ë¡œ ì´ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. íŠ¹íˆ 2-3ë…„ í›„ ê²°í˜¼ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ì´ì•¼ê¸°ê°€ ë‚˜ì˜¬ ê²ƒì´ë©°, ì„œë¡œì˜ ê°€ì¡±ë“¤ë„ ë‘ ë¶„ì˜ ê´€ê³„ë¥¼ ì¶•ë³µí•  ê²ƒì…ë‹ˆë‹¤.

**ğŸ’¡ êµ¬ì²´ì ì¸ í–‰ë™ ì§€ì¹¨**
1. ìƒëŒ€ë°©ê³¼ì˜ ëŒ€í™”ì—ì„œ ë”ìš± ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ì„¸ìš”
2. ì‘ì€ ì„ ë¬¼ì´ë‚˜ ê´€ì‹¬ í‘œí˜„ì„ í†µí•´ ë§ˆìŒì„ ì „ë‹¬í•˜ì„¸ìš”
3. í•¨ê»˜í•  ìˆ˜ ìˆëŠ” í™œë™ì„ ì œì•ˆí•´ë³´ì„¸ìš”
4. ìì‹ ì˜ ì§„ì •í•œ ëª¨ìŠµì„ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆì„¸ìš”

${name}ë‹˜ì˜ ì§„ì‹¤í•œ ë§ˆìŒì€ ë°˜ë“œì‹œ ìƒëŒ€ë°©ì—ê²Œ ì „ë‹¬ë  ê²ƒì…ë‹ˆë‹¤. ì¡°ê¸‰í•´í•˜ì§€ ë§ˆì‹œê³  ìì—°ìŠ¤ëŸ½ê²Œ ê´€ê³„ë¥¼ ë°œì „ì‹œì¼œ ë‚˜ê°€ì„¸ìš”.`;
}

async function analyzeThinking(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì´ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì˜ ì§„ì§œ ë§ˆìŒê³¼ ìƒê°ì„ ê¹Šì´ ìˆê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ì„ 1000ì ì´ìƒìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ê·¸ ì‚¬ëŒì´ ë‚˜ë¥¼ ì–´ë–»ê²Œ ìƒê°í•˜ê³  ìˆëŠ”ì§€
2. ë‚˜ì— ëŒ€í•œ ê·¸ ì‚¬ëŒì˜ ê°ì • ë³€í™” ê³¼ì •
3. ê·¸ ì‚¬ëŒì´ í‘œí˜„í•˜ì§€ ëª»í•˜ëŠ” ì†ë§ˆìŒ
4. ë‚˜ì™€ í•¨ê»˜ ìˆì„ ë•Œ ê·¸ ì‚¬ëŒì˜ ê¸°ë¶„
5. ê·¸ ì‚¬ëŒì´ ë‚˜ì—ê²Œ ë°”ë¼ëŠ” ê²ƒ
6. ì•ìœ¼ë¡œ ê·¸ ì‚¬ëŒì˜ ë§ˆìŒì´ ì–´ë–»ê²Œ ë³€í• ì§€
7. ê·¸ ì‚¬ëŒì˜ ë§ˆìŒì„ ë” ì–»ê¸° ìœ„í•œ ë°©ë²•

ì—°ì• ë¡œ ê³ ë¯¼í•˜ëŠ” ë§ˆìŒì„ ì´í•´í•˜ê³  í¬ë§ì ì´ë©´ì„œë„ í˜„ì‹¤ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ì‚¬ëŒì˜ ë§ˆìŒì„ ê¹Šì´ ì´í•´í•˜ëŠ” ì „ë¬¸ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ì—°ì• ë¡œ ê³ ë¯¼í•˜ëŠ” ì‚¬ëŒì—ê²Œ ë”°ëœ»í•˜ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.');
  
  return result || `ğŸ’­ **ê·¸ ì‚¬ëŒì˜ ì§„ì§œ ë§ˆìŒ**

${name}ë‹˜ì„ í–¥í•œ ê·¸ ì‚¬ëŒì˜ ë§ˆìŒì„ ê¹Šì´ ë“¤ì—¬ë‹¤ë³¸ ê²°ê³¼, ìƒê°ë³´ë‹¤ í›¨ì”¬ ê¸ì •ì ì¸ ê°ì •ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ${saju.month}ì›”ì£¼ì˜ ê¸°ìš´ìœ¼ë¡œ ë³¼ ë•Œ, ê·¸ ì‚¬ëŒì€ ${name}ë‹˜ì— ëŒ€í•´ íŠ¹ë³„í•œ ê´€ì‹¬ê³¼ í˜¸ê°ì„ ëŠë¼ê³  ìˆìŠµë‹ˆë‹¤.

**ğŸ’– í˜„ì¬ ê·¸ ì‚¬ëŒì˜ ë§ˆìŒ**
ê·¸ ì‚¬ëŒì€ ${name}ë‹˜ì„ ë‹¨ìˆœí•œ ì§€ì¸ ì´ìƒìœ¼ë¡œ ìƒê°í•˜ê³  ìˆìŠµë‹ˆë‹¤. ${name}ë‹˜ê³¼ ëŒ€í™”í•  ë•Œë©´ í‰ì†Œë³´ë‹¤ ë” ì‹ ê²½ì„ ì“°ê²Œ ë˜ê³ , ${name}ë‹˜ì˜ ì‘ì€ í–‰ë™ í•˜ë‚˜í•˜ë‚˜ì—ë„ ê´€ì‹¬ì„ ê¸°ìš¸ì´ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ${name}ë‹˜ì˜ ë”°ëœ»í•˜ê³  ë°°ë ¤ì‹¬ ë§ì€ ëª¨ìŠµì— ê¹Šì€ ì¸ìƒì„ ë°›ì•˜ìœ¼ë©°, ì´ëŸ° ì„±ê²©ì´ ìì‹ ì—ê²Œ ì•ˆì •ê°ì„ ì¤€ë‹¤ê³  ëŠë¼ê³  ìˆìŠµë‹ˆë‹¤.

**ğŸŒ± ê°ì • ë³€í™”ì˜ ê³¼ì •**
ì²˜ìŒì—ëŠ” ë‹¨ìˆœí•œ í˜¸ê° ì •ë„ì˜€ì§€ë§Œ, ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ${name}ë‹˜ì— ëŒ€í•œ ê°ì •ì´ ê¹Šì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ìµœê·¼ ë“¤ì–´ì„œëŠ” ${name}ë‹˜ê³¼ ë” ë§ì€ ì‹œê°„ì„ ë³´ë‚´ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì„ ìì£¼ í•˜ê³  ìˆìœ¼ë©°, ${name}ë‹˜ì´ ì—†ëŠ” ìë¦¬ì—ì„œë„ ìì—°ìŠ¤ëŸ½ê²Œ ${name}ë‹˜ ì´ì•¼ê¸°ê°€ ë‚˜ì˜¤ê³¤ í•©ë‹ˆë‹¤.

**ğŸ¤ í‘œí˜„í•˜ì§€ ëª»í•˜ëŠ” ì†ë§ˆìŒ**
ê·¸ ì‚¬ëŒì€ ${name}ë‹˜ì—ê²Œ ë” ë‹¤ê°€ê°€ê³  ì‹¶ì–´í•˜ì§€ë§Œ, í˜¹ì‹œ ìì‹ ì˜ ë§ˆìŒì´ ë¶€ë‹´ìŠ¤ëŸ¬ìš¸ê¹Œ ë´ ì¡°ì‹¬ìŠ¤ëŸ¬ì›Œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‚´ì‹¬ìœ¼ë¡œëŠ” ${name}ë‹˜ê³¼ ë‹¨ë‘˜ì´ ì‹œê°„ì„ ë³´ë‚´ê³  ì‹¶ì–´í•˜ë©°, ë” ê¹Šì€ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë˜í•œ ${name}ë‹˜ì˜ ì¼ìƒì´ë‚˜ ì·¨ë¯¸ì— ëŒ€í•´ì„œë„ ë” ìì„¸íˆ ì•Œê³  ì‹¶ì–´í•©ë‹ˆë‹¤.

**ğŸ˜Š í•¨ê»˜ ìˆì„ ë•Œì˜ ê¸°ë¶„**
${name}ë‹˜ê³¼ í•¨ê»˜ ìˆì„ ë•Œ ê·¸ ì‚¬ëŒì€ ë§¤ìš° í¸ì•ˆí•˜ê³  í–‰ë³µí•œ ê¸°ë¶„ì„ ëŠë‚ë‹ˆë‹¤. í‰ì†Œ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ìˆì„ ë•Œë³´ë‹¤ ë” ìì—°ìŠ¤ëŸ¬ìš´ ëª¨ìŠµì„ ë³´ì´ê²Œ ë˜ë©°, ì›ƒìŒë„ ë” ë§ì•„ì§‘ë‹ˆë‹¤. ${name}ë‹˜ì˜ ì¡´ì¬ ìì²´ê°€ ê·¸ ì‚¬ëŒì—ê²ŒëŠ” íë§ì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤.

**ğŸ’ ê·¸ ì‚¬ëŒì´ ë°”ë¼ëŠ” ê²ƒ**
ê·¸ ì‚¬ëŒì€ ${name}ë‹˜ì´ ìì‹ ì—ê²Œ ë” ë§ˆìŒì„ ì—´ì–´ì£¼ê¸°ë¥¼ ë°”ë¼ê³  ìˆìŠµë‹ˆë‹¤. ë” ìì£¼ ì—°ë½í•˜ê³ , ë” ë§ì€ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©°, ì„œë¡œì˜ ì§„ì†”í•œ ëª¨ìŠµì„ ë³´ì—¬ì£¼ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë˜í•œ ${name}ë‹˜ì´ ìì‹ ì„ íŠ¹ë³„í•˜ê²Œ ìƒê°í•´ì£¼ê¸°ë¥¼ ì€ë°€íˆ ë°”ë¼ê³  ìˆìŠµë‹ˆë‹¤.

**ğŸ”® ì•ìœ¼ë¡œì˜ ë§ˆìŒ ë³€í™”**
ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê·¸ ì‚¬ëŒì˜ ë§ˆìŒì€ ë”ìš± í™•ê³ í•´ì§ˆ ê²ƒì…ë‹ˆë‹¤. íŠ¹íˆ ì•ìœ¼ë¡œ 2-3ê°œì›” ë‚´ì— ${name}ë‹˜ì— ëŒ€í•œ ê°ì •ì„ ë” ì´ìƒ ìˆ¨ê¸°ê¸° ì–´ë ¤ì›Œí•  ê²ƒì´ë©°, ì–´ë–¤ í˜•íƒœë¡œë“  ìì‹ ì˜ ë§ˆìŒì„ í‘œí˜„í•˜ë ¤ê³  í•  ê²ƒì…ë‹ˆë‹¤.

**ğŸ’¡ ê·¸ ì‚¬ëŒì˜ ë§ˆìŒì„ ì–»ëŠ” ë°©ë²•**
1. ë” ìì£¼ ë¨¼ì € ì—°ë½ì„ ì·¨í•´ë³´ì„¸ìš”
2. ê·¸ ì‚¬ëŒì˜ ê´€ì‹¬ì‚¬ì— ëŒ€í•´ ì§ˆë¬¸í•˜ê³  ê²½ì²­í•´ì£¼ì„¸ìš”
3. ì‘ì€ ê³ ë¯¼ì´ë‚˜ ì¼ìƒì„ ê³µìœ í•˜ë©° ê±°ë¦¬ë¥¼ ì¢í˜€ë³´ì„¸ìš”
4. ìì—°ìŠ¤ëŸ½ê²Œ ë‘˜ë§Œì˜ ì‹œê°„ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”

ê·¸ ì‚¬ëŒì€ ì´ë¯¸ ${name}ë‹˜ì—ê²Œ ë§ˆìŒì„ ì—´ê³  ìˆìŠµë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ë” ìš©ê¸°ë¥¼ ë‚´ì–´ ë‹¤ê°€ê°€ì‹ ë‹¤ë©´ ë¶„ëª… ì¢‹ì€ ê²°ê³¼ê°€ ìˆì„ ê²ƒì…ë‹ˆë‹¤.`;
}

async function analyzeMarriage(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì˜ ê²°í˜¼ìš´ê³¼ ê²°í˜¼ìƒëŒ€ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ì„ 1000ì ì´ìƒìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ì–¸ì œì¯¤ ê²°í˜¼í•˜ê²Œ ë ì§€ êµ¬ì²´ì ì¸ ì‹œê¸°
2. ê²°í˜¼ìƒëŒ€ì˜ ì™¸ëª¨, ì„±ê²©, ì§ì—… ë“± ìƒì„¸í•œ íŠ¹ì§•
3. ì–´ë–¤ ê²½ë¡œë¡œ ë§Œë‚˜ê²Œ ë ì§€
4. ê²°í˜¼ ìƒí™œì˜ ëª¨ìŠµê³¼ íŠ¹ì§•
5. ê²°í˜¼ í›„ ë³€í™”ë  ì ë“¤
6. ì£¼ì˜í•´ì•¼ í•  ì ê³¼ ì¡°ì–¸
7. ê²°í˜¼ì„ ì•ë‹¹ê¸°ê±°ë‚˜ ì¢‹ì€ ìƒëŒ€ë¥¼ ë§Œë‚˜ëŠ” ë°©ë²•

ê²°í˜¼ì„ ê¿ˆê¾¸ëŠ” ë§ˆìŒì„ ì´í•´í•˜ê³  êµ¬ì²´ì ì´ê³  í¬ë§ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ê²°í˜¼ ì „ë¬¸ ìƒë‹´ì‚¬ì´ì ì‚¬ì£¼ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ê²°í˜¼ì„ ê¿ˆê¾¸ëŠ” ì‚¬ëŒì—ê²Œ êµ¬ì²´ì ì´ê³  ë”°ëœ»í•œ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.');
  
  return result || `ğŸ’’ **${name}ë‹˜ì˜ ê²°í˜¼ìš´ê³¼ ì´ìƒí˜•**

${name}ë‹˜ì˜ ì‚¬ì£¼ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•œ ê²°ê³¼, ê²°í˜¼ìš´ì´ ë§¤ìš° ì¢‹ìœ¼ë©° í–‰ë³µí•œ ê²°í˜¼ ìƒí™œì„ í•  ìˆ˜ ìˆëŠ” íŒ”ìì…ë‹ˆë‹¤. ${saju.day}ì¼ì£¼ì˜ íŠ¹ì„±ìƒ ê°€ì •ì„ ì¤‘ì‹œí•˜ê³  ë°°ìš°ìë¥¼ ì†Œì¤‘íˆ ì—¬ê¸°ëŠ” ì„±í–¥ì´ ê°•í•´ ì•ˆì •ì ì¸ ê²°í˜¼ ìƒí™œì„ ì˜ìœ„í•  ê²ƒì…ë‹ˆë‹¤.

**â° ê²°í˜¼ ì‹œê¸°**
${name}ë‹˜ì˜ ê²°í˜¼ ì ë ¹ê¸°ëŠ” ë§Œ 28-32ì„¸ ì‚¬ì´ë¡œ ë³´ì…ë‹ˆë‹¤. íŠ¹íˆ 29ì„¸ì™€ 31ì„¸ì— ê²°í˜¼ê³¼ ê´€ë ¨ëœ ì¤‘ìš”í•œ ë§Œë‚¨ì´ë‚˜ ê²°ì •ì´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ê³„ì ˆë¡œëŠ” ë´„(3-5ì›”)ì´ë‚˜ ê°€ì„(9-11ì›”)ì— ê²°í˜¼ì‹ì„ ì˜¬ë¦´ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë©°, ì´ ì‹œê¸°ì— ê²°í˜¼í•˜ë©´ ë”ìš± í–‰ë³µí•œ ê²°í˜¼ ìƒí™œì„ í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

**ğŸ‘¤ ê²°í˜¼ìƒëŒ€ì˜ íŠ¹ì§•**
${name}ë‹˜ì˜ ê²°í˜¼ìƒëŒ€ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§ˆ ê²ƒì…ë‹ˆë‹¤:

ì™¸ëª¨: í‚¤ëŠ” í‰ê·  ì´ìƒì´ë©°, ë‹¨ì •í•˜ê³  ê¹”ë”í•œ ì¸ìƒì„ ê°€ì§„ ë¶„ì…ë‹ˆë‹¤. ëˆˆì´ ì¸ìƒì ì´ê³  ë¯¸ì†Œê°€ ë”°ëœ»í•œ ë¶„ìœ¼ë¡œ, ì²«ì¸ìƒë¶€í„° í˜¸ê°ì„ ì¤„ ê²ƒì…ë‹ˆë‹¤.

ì„±ê²©: ì„±ì‹¤í•˜ê³  ì±…ì„ê°ì´ ê°•í•˜ë©°, ${name}ë‹˜ê³¼ ë¹„ìŠ·í•˜ê²Œ ê°€ì •ì„ ì¤‘ì‹œí•˜ëŠ” ê°€ì¹˜ê´€ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ìœ ë¨¸ ê°ê°ì´ ìˆì–´ ${name}ë‹˜ì„ ìì£¼ ì›ƒê²Œ ë§Œë“¤ ê²ƒì´ë©°, ê²°ì •ì ì¸ ìˆœê°„ì—ëŠ” ë“ ë“ í•œ ì§€ì›êµ°ì´ ë˜ì–´ì¤„ ê²ƒì…ë‹ˆë‹¤.

ì§ì—…: ì•ˆì •ì ì¸ ì§ì—…ì„ ê°€ì§„ ë¶„ìœ¼ë¡œ, êµìœ¡, ì˜ë£Œ, ê³µë¬´ì›, ë˜ëŠ” ì „ë¬¸ì§ì— ì¢…ì‚¬í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ê²½ì œì ìœ¼ë¡œë„ ì•ˆì •ë˜ì–´ ìˆì–´ ${name}ë‹˜ê³¼ í•¨ê»˜ ê³„íšì ì¸ ë¯¸ë˜ë¥¼ ì„¤ê³„í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

**ğŸ’• ë§Œë‚¨ì˜ ê²½ë¡œ**
ê²°í˜¼ìƒëŒ€ì™€ëŠ” ì§€ì¸ì˜ ì†Œê°œë‚˜ ì§ì¥, ì·¨ë¯¸ í™œë™ì„ í†µí•´ ë§Œë‚  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. íŠ¹íˆ êµìœ¡ì´ë‚˜ ë¬¸í™”ì™€ ê´€ë ¨ëœ ì¥ì†Œì—ì„œ ë§Œë‚  í™•ë¥ ì´ ë†’ìœ¼ë©°, ì²« ë§Œë‚¨ì—ì„œë¶€í„° ì„œë¡œì—ê²Œ íŠ¹ë³„í•œ ê°ì •ì„ ëŠë‚„ ê²ƒì…ë‹ˆë‹¤.

**ğŸ  ê²°í˜¼ ìƒí™œì˜ ëª¨ìŠµ**
${name}ë‹˜ì˜ ê²°í˜¼ ìƒí™œì€ ë§¤ìš° í™”ëª©í•˜ê³  ì•ˆì •ì ì¼ ê²ƒì…ë‹ˆë‹¤. ë¶€ë¶€ê°„ì˜ ì†Œí†µì´ ì›í™œí•˜ê³  ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ëŠ” ê´€ê³„ë¥¼ ìœ ì§€í•  ê²ƒì…ë‹ˆë‹¤. ì•„ì´ë“¤ê³¼ë„ ì¢‹ì€ ê´€ê³„ë¥¼ ë§ºì„ ê²ƒì´ë©°, ê°€ì¡± ëª¨ë‘ê°€ í–‰ë³µí•œ ê°€ì •ì„ ë§Œë“¤ì–´ê°ˆ ê²ƒì…ë‹ˆë‹¤.

**ğŸŒŸ ê²°í˜¼ í›„ ë³€í™”**
ê²°í˜¼ í›„ ${name}ë‹˜ì€ ë”ìš± ì„±ìˆ™í•´ì§€ê³  ì•ˆì •ê°ì„ ì–»ì„ ê²ƒì…ë‹ˆë‹¤. ë°°ìš°ìì˜ ì˜í–¥ìœ¼ë¡œ ìƒˆë¡œìš´ ì·¨ë¯¸ë‚˜ ê´€ì‹¬ì‚¬ë¥¼ ê°–ê²Œ ë  ìˆ˜ë„ ìˆìœ¼ë©°, ì‚¬íšŒì ìœ¼ë¡œë„ ë”ìš± í™œë°œí•´ì§ˆ ê²ƒì…ë‹ˆë‹¤.

**âš ï¸ ì£¼ì˜ì‚¬í•­ê³¼ ì¡°ì–¸**
ì™„ë²½í•œ ìƒëŒ€ë¥¼ ì°¾ìœ¼ë ¤ í•˜ê¸°ë³´ë‹¤ëŠ” ì„œë¡œ ë³´ì™„í•  ìˆ˜ ìˆëŠ” ê´€ê³„ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë˜í•œ ê²°í˜¼ ì „ ì¶©ë¶„í•œ ëŒ€í™”ë¥¼ í†µí•´ ê°€ì¹˜ê´€ì„ í™•ì¸í•˜ëŠ” ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤.

**ğŸ’¡ ì¢‹ì€ ì¸ì—°ì„ ë§Œë‚˜ëŠ” ë°©ë²•**
1. ìê¸°ê³„ë°œì— í˜ì¨ ë§¤ë ¥ì ì¸ ì‚¬ëŒì´ ë˜ì„¸ìš”
2. ë‹¤ì–‘í•œ ëª¨ì„ì´ë‚˜ í™œë™ì— ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ì„¸ìš”
3. ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ì¢‹ì€ ì‚¬ëŒì´ ìˆìœ¼ë©´ ì†Œê°œí•´ë‹¬ë¼ê³  ë¶€íƒí•˜ì„¸ìš”
4. ë„ˆë¬´ ì¡°ê¸‰í•´í•˜ì§€ ë§ê³  ìì—°ìŠ¤ëŸ¬ìš´ ë§Œë‚¨ì„ ê¸°ë‹¤ë¦¬ì„¸ìš”

${name}ë‹˜ì˜ ê²°í˜¼ìš´ì€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ë” ê¸°ë‹¤ë¦¬ì‹œë©´ ë¶„ëª… ìš´ëª…ì˜ ìƒëŒ€ë¥¼ ë§Œë‚˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.`;
}

async function analyzeStrategy(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì„ ìœ„í•œ ë§ì¶¤í˜• ì—°ì•  ì„±ê³µ ì „ëµì„ êµ¬ì²´ì ìœ¼ë¡œ ì œì‹œí•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ì„ 1000ì ì´ìƒìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ê°œì¸ì˜ ì—°ì•  ìŠ¤íƒ€ì¼ê³¼ ì¥ë‹¨ì  ë¶„ì„
2. ì–´ë–¤ íƒ€ì…ì˜ ì´ì„±ì—ê²Œ ì–´í•„í•  ìˆ˜ ìˆëŠ”ì§€
3. ì—°ì• ì—ì„œ ì„±ê³µí•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ ì „ëµ
4. í”¼í•´ì•¼ í•  ì—°ì•  íŒ¨í„´ê³¼ ì‹¤ìˆ˜ë“¤
5. ë§¤ë ¥ì„ ë†’ì´ëŠ” ë°©ë²•ë“¤
6. ìƒí™©ë³„ ëŒ€ì²˜ ë°©ë²• (ì²« ë§Œë‚¨, ë°ì´íŠ¸, ê³ ë°± ë“±)
7. ì¥ê¸°ì ì¸ ê´€ê³„ ìœ ì§€ ë¹„ê²°

ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸ìœ¼ë¡œ ì—°ì•  ì„±ê³µì„ ë„ì™€ì£¼ì„¸ìš”.`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ì—°ì•  ì½”ì¹˜ì´ì ì‚¬ì£¼ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì—°ì•  ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.');
  
  return result || `ğŸ¯ **${name}ë‹˜ë§Œì˜ ì—°ì•  ì„±ê³µ ì „ëµ**

${name}ë‹˜ì˜ ì‚¬ì£¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§ì¶¤í˜• ì—°ì•  ì „ëµì„ ì œì‹œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ${saju.day}ì¼ì£¼ì˜ íŠ¹ì„±ì„ ìµœëŒ€í•œ í™œìš©í•˜ë©´ ë¶„ëª… ì—°ì• ì—ì„œ ì„±ê³µí•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

**ğŸ’– ${name}ë‹˜ì˜ ì—°ì•  ìŠ¤íƒ€ì¼ ë¶„ì„**
${name}ë‹˜ì€ ì§„ì‹¤í•˜ê³  ê¹Šì´ ìˆëŠ” ì‚¬ë‘ì„ ì¶”êµ¬í•˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤. ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚´ì§€ëŠ” ì•Šì§€ë§Œ ë‚´ë©´ì— ëœ¨ê±°ìš´ ì—´ì •ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, í•œ ë²ˆ ì‚¬ë‘í•˜ë©´ ê¹Šê³  ì˜¤ë˜ê°€ëŠ” ì‚¬ë‘ì„ í•©ë‹ˆë‹¤. ìƒëŒ€ë°©ì„ ë°°ë ¤í•˜ê³  ì´í•´í•˜ë ¤ëŠ” ë§ˆìŒì´ ê°•í•´ ì•ˆì •ì ì¸ ê´€ê³„ë¥¼ ë§Œë“œëŠ” ë° ë›°ì–´ë‚©ë‹ˆë‹¤.

ì¥ì : ì§„ì‹¤ì„±, ë°°ë ¤ì‹¬, ê¹Šì´ ìˆëŠ” ì‚¬ë‘, ì•ˆì •ê° ì œê³µ
ë‹¨ì : ì†Œê·¹ì  í‘œí˜„, ì™„ë²½ì£¼ì˜ ì„±í–¥, ìƒì²˜ë°›ê¸° ì‰¬ìš´ ë§ˆìŒ

**ğŸ‘¥ ì–´í•„ ê°€ëŠ¥í•œ ì´ì„± íƒ€ì…**
${name}ë‹˜ì—ê²Œ ë§¤ë ¥ì„ ëŠë‚„ ì´ì„±ì˜ íŠ¹ì§•:
- ì§„ì‹¤í•˜ê³  ì„±ì‹¤í•œ ì‚¬ëŒì„ ì¢‹ì•„í•˜ëŠ” íƒ€ì…
- ì•ˆì •ì ì¸ ê´€ê³„ë¥¼ ì›í•˜ëŠ” ì‚¬ëŒ
- ê¹Šì´ ìˆëŠ” ëŒ€í™”ë¥¼ ì¦ê¸°ëŠ” ì§€ì ì¸ íƒ€ì…
- ê°€ì •ì ì´ê³  ë”°ëœ»í•œ ì‚¬ëŒì„ ì„ í˜¸í•˜ëŠ” íƒ€ì…

**ğŸ¯ êµ¬ì²´ì ì¸ ì—°ì•  ì„±ê³µ ì „ëµ**

1ë‹¨ê³„ - ì²«ì¸ìƒ ë§Œë“¤ê¸°:
${name}ë‹˜ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ë¯¸ì†Œì™€ ë”°ëœ»í•œ ëˆˆë¹›ì„ ì ê·¹ í™œìš©í•˜ì„¸ìš”. ê³¼ë„í•œ ê¾¸ë°ˆë³´ë‹¤ëŠ” ê¹”ë”í•˜ê³  ë‹¨ì •í•œ ìŠ¤íƒ€ì¼ì´ ë” ë§¤ë ¥ì ìœ¼ë¡œ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤.

2ë‹¨ê³„ - ê´€ì‹¬ ëŒê¸°:
ì§ì ‘ì ì¸ ì–´í•„ë³´ë‹¤ëŠ” ìƒëŒ€ë°©ì˜ ì´ì•¼ê¸°ì— ì§„ì‹¬ìœ¼ë¡œ ê·€ ê¸°ìš¸ì´ëŠ” ëª¨ìŠµì„ ë³´ì—¬ì£¼ì„¸ìš”. ${name}ë‹˜ì˜ ê³µê° ëŠ¥ë ¥ê³¼ ì´í•´ì‹¬ì´ ìƒëŒ€ë°©ì—ê²Œ ê¹Šì€ ì¸ìƒì„ ì¤„ ê²ƒì…ë‹ˆë‹¤.

3ë‹¨ê³„ - ê´€ê³„ ë°œì „ì‹œí‚¤ê¸°:
ì‘ì€ ê´€ì‹¬ê³¼ ë°°ë ¤ë¥¼ ê¾¸ì¤€íˆ í‘œí˜„í•˜ì„¸ìš”. ìƒëŒ€ë°©ì´ í˜ë“¤ì–´í•  ë•Œ ì˜†ì—ì„œ ë“ ë“ í•œ ì§€ì§€ìê°€ ë˜ì–´ì£¼ëŠ” ê²ƒì´ ${name}ë‹˜ì˜ ê°€ì¥ í° ë¬´ê¸°ì…ë‹ˆë‹¤.

**âš ï¸ í”¼í•´ì•¼ í•  ì—°ì•  íŒ¨í„´**
1. ë„ˆë¬´ ì™„ë²½í•œ ìƒëŒ€ë¥¼ ì°¾ìœ¼ë ¤ í•˜ì§€ ë§ˆì„¸ìš”
2. ìì‹ ì˜ ê°ì •ì„ ë„ˆë¬´ ìˆ¨ê¸°ì§€ ë§ˆì„¸ìš”
3. ìƒëŒ€ë°©ì˜ ëª¨ë“  ê²ƒì„ ë§ì¶°ì£¼ë ¤ í•˜ì§€ ë§ˆì„¸ìš”
4. ê±°ì ˆë‹¹í•  ê²ƒì„ ë¯¸ë¦¬ ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”

**âœ¨ ë§¤ë ¥ í–¥ìƒ ë°©ë²•**
- ìì‹ ë§Œì˜ ì·¨ë¯¸ë‚˜ íŠ¹ê¸°ë¥¼ ê°œë°œí•˜ì„¸ìš”
- ê¸ì •ì ì¸ ë§ˆì¸ë“œë¥¼ ìœ ì§€í•˜ì„¸ìš”
- ê±´ê°•í•œ ìƒí™œ ìŠµê´€ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë§¤ë ¥ì„ ë°œì‚°í•˜ì„¸ìš”
- ë‹¤ì–‘í•œ ê²½í—˜ì„ í†µí•´ ëŒ€í™” ì†Œì¬ë¥¼ ëŠ˜ë¦¬ì„¸ìš”

**ğŸ“‹ ìƒí™©ë³„ ëŒ€ì²˜ë²•**

ì²« ë§Œë‚¨: ìì—°ìŠ¤ëŸ½ê³  í¸ì•ˆí•œ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“œì„¸ìš”. ìƒëŒ€ë°©ì´ ê¸´ì¥í•˜ì§€ ì•Šë„ë¡ ë”°ëœ»í•œ ë¯¸ì†Œì™€ ë¶€ë“œëŸ¬ìš´ ëª©ì†Œë¦¬ë¡œ ëŒ€í™”í•˜ì„¸ìš”.

ë°ì´íŠ¸: ìƒëŒ€ë°©ì˜ ì·¨í–¥ì„ ê³ ë ¤í•œ ì¥ì†Œë¥¼ ì„ íƒí•˜ê³ , í•¨ê»˜ ì¦ê¸¸ ìˆ˜ ìˆëŠ” í™œë™ì„ ì œì•ˆí•˜ì„¸ìš”. ë¬´ë¦¬í•˜ì§€ ë§ê³  ìì—°ìŠ¤ëŸ½ê²Œ í–‰ë™í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ê³ ë°±: ${name}ë‹˜ì˜ ì§„ì‹¤í•œ ë§ˆìŒì„ ì†”ì§í•˜ê²Œ ì „ë‹¬í•˜ì„¸ìš”. í™”ë ¤í•œ ì´ë²¤íŠ¸ë³´ë‹¤ëŠ” ì¡°ìš©í•˜ê³  ì˜ë¯¸ ìˆëŠ” ì¥ì†Œì—ì„œ ì§„ì‹¬ì„ ë‹´ì•„ ê³ ë°±í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

**ğŸ’ ì¥ê¸°ì  ê´€ê³„ ìœ ì§€ ë¹„ê²°**
1. ê¾¸ì¤€í•œ ì†Œí†µê³¼ ê´€ì‹¬ í‘œí˜„
2. ì„œë¡œì˜ ê°œì¸ ì‹œê°„ê³¼ ê³µê°„ ì¡´ì¤‘
3. ì‘ì€ ê¸°ë…ì¼ë“¤ì„ ì±™ê¸°ëŠ” ì„¸ì‹¬í•¨
4. ê°ˆë“± ìƒí™©ì—ì„œì˜ í˜„ëª…í•œ ëŒ€ì²˜
5. í•¨ê»˜ ì„±ì¥í•˜ë ¤ëŠ” ë…¸ë ¥

${name}ë‹˜ì˜ ì§„ì‹¤í•œ ë§ˆìŒê³¼ ë”°ëœ»í•œ ì„±ê²©ì€ ë¶„ëª… ëˆ„êµ°ê°€ì—ê²Œ í° ê°ë™ì„ ì¤„ ê²ƒì…ë‹ˆë‹¤. ìì‹ ê°ì„ ê°€ì§€ê³  ì ê·¹ì ìœ¼ë¡œ ë‹¤ê°€ê°€ì„¸ìš”!`;
}

async function analyzeSoulmate(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì˜ ìš´ëª…ì˜ ìƒëŒ€ì™€ ë§Œë‚  ì‹œê¸°ë¥¼ ìƒì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ì„ 1000ì ì´ìƒìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ìš´ëª…ì˜ ìƒëŒ€ì˜ êµ¬ì²´ì ì¸ íŠ¹ì§• (ì™¸ëª¨, ì„±ê²©, ê°€ì¹˜ê´€)
2. ì–¸ì œ, ì–´ë””ì„œ, ì–´ë–»ê²Œ ë§Œë‚˜ê²Œ ë ì§€
3. ì²« ë§Œë‚¨ì˜ ìƒí™©ê³¼ ëŠë‚Œ
4. ìš´ëª…ì˜ ìƒëŒ€ì„ì„ ì•Œ ìˆ˜ ìˆëŠ” ì‹ í˜¸ë“¤
5. ê·¸ ì‚¬ëŒê³¼ì˜ ê´€ê³„ ë°œì „ ê³¼ì •
6. ìš´ëª…ì˜ ë§Œë‚¨ì„ ì•ë‹¹ê¸°ëŠ” ë°©ë²•
7. ë†“ì¹˜ì§€ ì•Šê¸° ìœ„í•œ ì£¼ì˜ì‚¬í•­

ìš´ëª…ì  ì‚¬ë‘ì„ ê¿ˆê¾¸ëŠ” ë§ˆìŒì„ ì´í•´í•˜ê³  í¬ë§ì ì´ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ ìš´ëª…ì  ì‚¬ë‘ì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ìš´ëª…ì˜ ìƒëŒ€ë¥¼ ê¿ˆê¾¸ëŠ” ì‚¬ëŒì—ê²Œ í¬ë§ì ì´ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.');
  
  return result || `ğŸ’ **${name}ë‹˜ì˜ ìš´ëª…ì˜ ìƒëŒ€**

${name}ë‹˜ì˜ ì‚¬ì£¼ì—ëŠ” íŠ¹ë³„í•œ ì¸ì—°ì˜ ê¸°ìš´ì´ ê°•í•˜ê²Œ ë‚˜íƒ€ë‚˜ ìˆìŠµë‹ˆë‹¤. ${saju.year}ë…„ì£¼ì™€ ${saju.day}ì¼ì£¼ì˜ ì¡°í•©ì„ ë³¼ ë•Œ, ë¶„ëª…íˆ ìš´ëª…ì ì¸ ë§Œë‚¨ì´ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.

**ğŸ‘¤ ìš´ëª…ì˜ ìƒëŒ€ íŠ¹ì§•**

ì™¸ëª¨: í‚¤ëŠ” ${name}ë‹˜ë³´ë‹¤ ì•½ê°„ í¬ë©°, ê¹”ë”í•˜ê³  ì§€ì ì¸ ì¸ìƒì„ ê°€ì§„ ë¶„ì…ë‹ˆë‹¤. ëˆˆì´ ë§‘ê³  ì¸ìƒì´ ì˜¨í™”í•˜ë©°, ë¯¸ì†Œ ì§€ì„ ë•Œ íŠ¹íˆ ë§¤ë ¥ì ì…ë‹ˆë‹¤. íŒ¨ì…˜ ì„¼ìŠ¤ê°€ ì¢‹ê³  ë‹¨ì •í•œ ìŠ¤íƒ€ì¼ì„ ì„ í˜¸í•©ë‹ˆë‹¤.

ì„±ê²©: ì°¨ë¶„í•˜ê³  ì‚¬ë ¤ê¹Šì€ ì„±ê²©ìœ¼ë¡œ, ${name}ë‹˜ê³¼ ë¹„ìŠ·í•œ ê°€ì¹˜ê´€ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ìœ ë¨¸ ê°ê°ì´ ìˆì–´ ${name}ë‹˜ì„ ìì£¼ ì›ƒê²Œ ë§Œë“¤ ê²ƒì´ë©°, ì–´ë ¤ìš´ ìƒí™©ì—ì„œë„ ì¹¨ì°©í•˜ê²Œ ëŒ€ì²˜í•˜ëŠ” ëŠ¥ë ¥ì´ ìˆìŠµë‹ˆë‹¤. ê°€ì¡±ì„ ì†Œì¤‘íˆ ì—¬ê¸°ê³  ë¯¸ë˜ì— ëŒ€í•œ ê³„íšì´ ëšœë ·í•œ ë¶„ì…ë‹ˆë‹¤.

ê°€ì¹˜ê´€: ì§„ì‹¤ì„±ê³¼ ì„±ì‹¤í•¨ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ë©°, ${name}ë‹˜ì²˜ëŸ¼ ê¹Šì´ ìˆëŠ” ê´€ê³„ë¥¼ ì¶”êµ¬í•©ë‹ˆë‹¤. ë¬¼ì§ˆì ì¸ ê²ƒë³´ë‹¤ëŠ” ì •ì‹ ì ì¸ í’ìš”ë¡œì›€ì„ ë” ì¤‘ì‹œí•˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.

**ğŸ“ ë§Œë‚¨ì˜ ì‹œê¸°ì™€ ì¥ì†Œ**
ìš´ëª…ì˜ ìƒëŒ€ì™€ëŠ” ì•ìœ¼ë¡œ 18-24ê°œì›” ë‚´ì— ë§Œë‚˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. íŠ¹íˆ ë´„(3-5ì›”)ì´ë‚˜ ê°€ì„(9-11ì›”)ì— ë§Œë‚  ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì€ ì¥ì†Œì—ì„œ ë§Œë‚  í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤:
- êµìœ¡ ê´€ë ¨ ì¥ì†Œ (ë„ì„œê´€, ê°•ì˜ì‹¤, ì„¸ë¯¸ë‚˜)
- ë¬¸í™” ê³µê°„ (ë¯¸ìˆ ê´€, ë°•ë¬¼ê´€, ê³µì—°ì¥)
- ì§€ì¸ì˜ ì†Œê°œíŒ…ì´ë‚˜ ëª¨ì„
- ì·¨ë¯¸ í™œë™ ê´€ë ¨ ì¥ì†Œ

**ğŸ’« ì²« ë§Œë‚¨ì˜ ìƒí™©**
ì²« ë§Œë‚¨ì€ ë§¤ìš° ìì—°ìŠ¤ëŸ½ê³  í¸ì•ˆí•œ ë¶„ìœ„ê¸°ì—ì„œ ì´ë£¨ì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤. ì„œë¡œ ëˆˆì´ ë§ˆì£¼ì¹˜ëŠ” ìˆœê°„ íŠ¹ë³„í•œ ëŠë‚Œì„ ë°›ì„ ê²ƒì´ë©°, ëŒ€í™”ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì ¸ ì‹œê°„ ê°€ëŠ” ì¤„ ëª¨ë¥¼ ê²ƒì…ë‹ˆë‹¤. ${name}ë‹˜ì€ ê·¸ ìˆœê°„ 'ì´ ì‚¬ëŒì´ íŠ¹ë³„í•˜ë‹¤'ëŠ” ì§ê°ì„ ë°›ì„ ê²ƒì…ë‹ˆë‹¤.

**ğŸ”® ìš´ëª…ì˜ ìƒëŒ€ì„ì„ ì•Œ ìˆ˜ ìˆëŠ” ì‹ í˜¸**
1. ì²« ë§Œë‚¨ë¶€í„° ëŒ€í™”ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§
2. ì„œë¡œì˜ ê°€ì¹˜ê´€ì´ë‚˜ ì·¨í–¥ì´ ë†€ëë„ë¡ ë¹„ìŠ·í•¨
3. í•¨ê»˜ ìˆì„ ë•Œ ì‹œê°„ì´ ë¹¨ë¦¬ ì§€ë‚˜ê°
4. ìƒëŒ€ë°© ìƒê°ì´ ìì£¼ ë‚¨
5. ê¿ˆì—ì„œ ê·¸ ì‚¬ëŒì´ ë‚˜íƒ€ë‚¨
6. ìš°ì—°í•œ ë§Œë‚¨ì´ ìì£¼ ìƒê¹€
7. ì£¼ë³€ ì‚¬ëŒë“¤ì´ ì˜ ì–´ìš¸ë¦°ë‹¤ê³  ë§í•¨

**ğŸ’• ê´€ê³„ ë°œì „ ê³¼ì •**
ì²« ë§Œë‚¨ í›„ 2-3ì£¼ ë‚´ì— ë‹¤ì‹œ ë§Œë‚  ê¸°íšŒê°€ ìƒê¸¸ ê²ƒì´ë©°, ê·¸ë•Œë¶€í„° ë³¸ê²©ì ì¸ ê´€ê³„ê°€ ì‹œì‘ë  ê²ƒì…ë‹ˆë‹¤. 3ê°œì›” ì •ë„ ì§€ë‚˜ë©´ ì„œë¡œì— ëŒ€í•œ ê°ì •ì„ í™•ì‹ í•˜ê²Œ ë˜ê³ , 6ê°œì›” í›„ì—ëŠ” ì§„ì§€í•œ êµì œë¥¼ ì‹œì‘í•  ê²ƒì…ë‹ˆë‹¤. 1ë…„ í›„ì—ëŠ” ê²°í˜¼ì— ëŒ€í•œ ì´ì•¼ê¸°ê°€ ë‚˜ì˜¬ ê²ƒì…ë‹ˆë‹¤.

**âš¡ ìš´ëª…ì˜ ë§Œë‚¨ì„ ì•ë‹¹ê¸°ëŠ” ë°©ë²•**
1. ë‹¤ì–‘í•œ ë¬¸í™” í™œë™ì— ì°¸ì—¬í•˜ì„¸ìš”
2. ìƒˆë¡œìš´ ì·¨ë¯¸ë‚˜ ê´€ì‹¬ì‚¬ë¥¼ ê°œë°œí•˜ì„¸ìš”
3. ì§€ì¸ë“¤ì˜ ëª¨ì„ì— ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ì„¸ìš”
4. ìê¸°ê³„ë°œì— í˜ì¨ ë§¤ë ¥ì ì¸ ì‚¬ëŒì´ ë˜ì„¸ìš”
5. ê¸ì •ì ì¸ ë§ˆìŒê°€ì§ì„ ìœ ì§€í•˜ì„¸ìš”
6. ì§ê°ì„ ë¯¿ê³  ìš©ê¸° ìˆê²Œ í–‰ë™í•˜ì„¸ìš”

**âš ï¸ ë†“ì¹˜ì§€ ì•Šê¸° ìœ„í•œ ì£¼ì˜ì‚¬í•­**
1. ì²«ì¸ìƒë§Œìœ¼ë¡œ íŒë‹¨í•˜ì§€ ë§ˆì„¸ìš”
2. ë„ˆë¬´ ì™„ë²½í•œ ì‚¬ëŒì„ ì°¾ìœ¼ë ¤ í•˜ì§€ ë§ˆì„¸ìš”
3. ê¸°íšŒê°€ ì™”ì„ ë•Œ ì£¼ì €í•˜ì§€ ë§ˆì„¸ìš”
4. ìƒëŒ€ë°©ì˜ ì§„ì‹¬ì„ ì•Œì•„ë³´ëŠ” ëˆˆì„ ê¸°ë¥´ì„¸ìš”
5. ìì‹ ì˜ ì§ê°ì„ ë¯¿ìœ¼ì„¸ìš”

**ğŸŒŸ íŠ¹ë³„í•œ ì¡°ì–¸**
${name}ë‹˜ì˜ ìš´ëª…ì˜ ìƒëŒ€ëŠ” ì´ë¯¸ ${name}ë‹˜ ì£¼ë³€ ì–´ë”˜ê°€ì— ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë§Œë‚¨ì—ë§Œ ì§‘ì¤‘í•˜ì§€ ë§ê³ , ê¸°ì¡´ì— ì•Œê³  ìˆë˜ ì‚¬ëŒë“¤ ì¤‘ì—ì„œë„ ë‹¤ì‹œ í•œ ë²ˆ ì‚´í´ë³´ì„¸ìš”. ë•Œë¡œëŠ” ê°€ì¥ ê°€ê¹Œìš´ ê³³ì— ìš´ëª…ì´ ìˆ¨ì–´ìˆê¸°ë„ í•©ë‹ˆë‹¤.

${name}ë‹˜ì˜ ì§„ì‹¤í•œ ë§ˆìŒê³¼ ë”°ëœ»í•œ ì„±ê²©ì€ ë¶„ëª… ìš´ëª…ì˜ ìƒëŒ€ì—ê²Œ í° ê°ë™ì„ ì¤„ ê²ƒì…ë‹ˆë‹¤. ì¡°ê¸‰í•´í•˜ì§€ ë§ˆì‹œê³  ìì—°ìŠ¤ëŸ½ê²Œ ê¸°ë‹¤ë¦¬ì„¸ìš”. ìš´ëª…ì€ ê°€ì¥ ì™„ë²½í•œ íƒ€ì´ë°ì— ì°¾ì•„ì˜¬ ê²ƒì…ë‹ˆë‹¤.`;
}

async function analyzeTiming(name, gender, saju) {
  const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
  const prompt = `${name}ë‹˜(${genderText})ì˜ ì—°ì•  ê´€ë ¨ ì¤‘ìš”í•œ íƒ€ì´ë°ë“¤ì„ ìƒì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”.
ì‚¬ì£¼: ë…„ì£¼(${saju.year}) ì›”ì£¼(${saju.month}) ì¼ì£¼(${saju.day}) ì‹œì£¼(${saju.time})

ë‹¤ìŒ í•­ëª©ì„ 1000ì ì´ìƒìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. ê³ ë°±í•˜ê¸° ì¢‹ì€ ì‹œê¸°ì™€ ë°©ë²•
2. í”„ë¡œí¬ì¦ˆ ìµœì  íƒ€ì´ë°
3. ì—°ì• ìš´ì´ ìƒìŠ¹í•˜ëŠ” ì‹œê¸°ë“¤
4. í”¼í•´ì•¼ í•  ìœ„í—˜í•œ ì‹œê¸°ë“¤
5. ì¤‘ìš”í•œ ê²°ì •ì„ ë‚´ë¦¬ê¸° ì¢‹ì€ ë•Œ
6. ê´€ê³„ íšŒë³µì´ë‚˜ í™”í•´ì˜ íƒ€ì´ë°
7. ì›”ë³„, ê³„ì ˆë³„ ì—°ì•  ì „ëµ

íƒ€ì´ë°ì˜ ì¤‘ìš”ì„±ì„ ì´í•´í•˜ê³  êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.`;

  const result = await callOpenAI(prompt, 'ë‹¹ì‹ ì€ íƒ€ì´ë°ì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì—°ì• ì—ì„œ ì¤‘ìš”í•œ ìˆœê°„ë“¤ì˜ ìµœì  íƒ€ì´ë°ì„ ì•Œë ¤ì£¼ì„¸ìš”.');
  
  return result || `ğŸ”® **${name}ë‹˜ì˜ ì—°ì•  íƒ€ì´ë° ê°€ì´ë“œ**

${name}ë‹˜ì˜ ì‚¬ì£¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—°ì• ì—ì„œ ì¤‘ìš”í•œ íƒ€ì´ë°ë“¤ì„ ë¶„ì„í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ${saju.time}ì‹œì£¼ì˜ ê¸°ìš´ì„ ë³´ë©´, íƒ€ì´ë°ì„ ì˜ ë§ì¶”ë©´ ì—°ì• ì—ì„œ í° ì„±ê³µì„ ê±°ë‘˜ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

**ğŸ’– ê³ ë°±í•˜ê¸° ì¢‹ì€ ì‹œê¸°**
${name}ë‹˜ì—ê²Œ ê°€ì¥ ì¢‹ì€ ê³ ë°± íƒ€ì´ë°ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

ì‹œê¸°: ë§¤ì›” ë³´ë¦„ë‹¬ ì „í›„ 3ì¼ (ìŒë ¥ 13ì¼-17ì¼)ì´ ê°€ì¥ ì¢‹ìœ¼ë©°, íŠ¹íˆ ë´„(3-5ì›”)ê³¼ ê°€ì„(9-11ì›”)ì´ ìµœì ì…ë‹ˆë‹¤.

ì‹œê°„ëŒ€: ì˜¤í›„ 7ì‹œ-9ì‹œ ì‚¬ì´ê°€ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤. ì´ ì‹œê°„ëŒ€ì—ëŠ” ${name}ë‹˜ì˜ ë§¤ë ¥ì´ ê°€ì¥ ë¹›ë‚˜ë©°, ìƒëŒ€ë°©ë„ ê°ì •ì ìœ¼ë¡œ ì—´ë ¤ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

ë°©ë²•: í™”ë ¤í•œ ì´ë²¤íŠ¸ë³´ë‹¤ëŠ” ì¡°ìš©í•˜ê³  ì˜ë¯¸ ìˆëŠ” ì¥ì†Œì—ì„œ ì§„ì‹¬ì„ ë‹´ì•„ ê³ ë°±í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì‚°ì±…ë¡œë‚˜ ì¹´í˜ ê°™ì€ í¸ì•ˆí•œ ê³µê°„ì´ ì í•©í•©ë‹ˆë‹¤.

**ğŸ’ í”„ë¡œí¬ì¦ˆ ìµœì  íƒ€ì´ë°**
ê²°í˜¼ í”„ë¡œí¬ì¦ˆëŠ” êµì œ ì‹œì‘ í›„ 2-3ë…„ ì‚¬ì´ê°€ ê°€ì¥ ì í•©í•©ë‹ˆë‹¤. êµ¬ì²´ì ìœ¼ë¡œëŠ”:
- ê³„ì ˆ: ë´„(4-5ì›”) ë˜ëŠ” ê°€ì„(10-11ì›”)
- ë‚ ì§œ: ë‘ ì‚¬ëŒì—ê²Œ ì˜ë¯¸ ìˆëŠ” ê¸°ë…ì¼ì´ë‚˜ ìƒëŒ€ë°© ìƒì¼ ì „í›„
- ì‹œê°„: ì¼ëª° ì‹œê°„ëŒ€ (ì˜¤í›„ 6-7ì‹œ)ê°€ ê°€ì¥ ë¡œë§¨í‹±í•©ë‹ˆë‹¤

**ğŸ“ˆ ì—°ì• ìš´ ìƒìŠ¹ ì‹œê¸°**
${name}ë‹˜ì˜ ì—°ì• ìš´ì´ íŠ¹íˆ ì¢‹ì€ ì‹œê¸°ë“¤:

2024ë…„: 4ì›”, 7ì›”, 10ì›”, 12ì›”
2025ë…„: 3ì›”, 6ì›”, 9ì›”, 11ì›”

ì´ ì‹œê¸°ì—ëŠ” ìƒˆë¡œìš´ ë§Œë‚¨ì˜ ê¸°íšŒê°€ ë§ì•„ì§€ê³ , ê¸°ì¡´ ê´€ê³„ë„ í•œ ë‹¨ê³„ ë°œì „í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì ê·¹ì ìœ¼ë¡œ ì‚¬íšŒ í™œë™ì— ì°¸ì—¬í•˜ê³  ìƒˆë¡œìš´ ì‚¬ëŒë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”.

**âš ï¸ ì£¼ì˜í•´ì•¼ í•  ì‹œê¸°**
ë‹¤ìŒ ì‹œê¸°ì—ëŠ” ì—°ì•  ê´€ë ¨ ì¤‘ìš”í•œ ê²°ì •ì„ í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤:
- ë§¤ì›” ì´ˆìŠ¹ë‹¬ ì „í›„ (ìŒë ¥ 1ì¼-3ì¼)
- ì—¬ë¦„ ì¥ë§ˆì²  (6ì›” ë§-7ì›” ì´ˆ)
- ì—°ë§ì—°ì‹œ (12ì›” ë§-1ì›” ì´ˆ)

ì´ ì‹œê¸°ì—ëŠ” ê°ì •ì´ ë¶ˆì•ˆì •í•´ì§€ê¸° ì‰½ê³ , ì˜¤í•´ë‚˜ ê°ˆë“±ì´ ìƒê¸¸ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

**ğŸ¯ ì¤‘ìš”í•œ ê²°ì •ì˜ íƒ€ì´ë°**
ì—°ì• ì—ì„œ ì¤‘ìš”í•œ ê²°ì •(ì‚¬ê·€ê¸°, ë™ê±°, ê²°í˜¼ ë“±)ì„ ë‚´ë¦´ ë•ŒëŠ”:
- ë³´ë¦„ë‹¬ì´ ëœ¨ëŠ” ë‚  ì „í›„ 3ì¼
- ë‘ ì‚¬ëŒ ëª¨ë‘ ì»¨ë””ì…˜ì´ ì¢‹ì€ ë‚ 
- ì¶©ë¶„í•œ ëŒ€í™”ë¥¼ ë‚˜ëˆˆ í›„
- ì£¼ë³€ì˜ ì¶•ë³µì„ ë°›ì„ ìˆ˜ ìˆëŠ” ìƒí™©

**ğŸ’” ê´€ê³„ íšŒë³µì˜ íƒ€ì´ë°**
ë§Œì•½ ê°ˆë“±ì´ë‚˜ ì˜¤í•´ê°€ ìƒê²¼ë‹¤ë©´:
- ê°ì •ì´ ê°€ë¼ì•‰ì€ í›„ 3-7ì¼ ë’¤
- ìƒëŒ€ë°©ì˜ ìƒì¼ì´ë‚˜ ê¸°ë…ì¼ì„ í™œìš©
- ì¡°ìš©í•˜ê³  í¸ì•ˆí•œ í™˜ê²½ì—ì„œ
- ì§„ì‹¬ì–´ë¦° ì‚¬ê³¼ì™€ í•¨ê»˜

**ğŸ“… ì›”ë³„ ì—°ì•  ì „ëµ**

1-2ì›”: ìƒˆí•´ ê³„íšê³¼ í•¨ê»˜ ì—°ì•  ëª©í‘œ ì„¤ì •, ìê¸°ê³„ë°œì— ì§‘ì¤‘
3-5ì›”: ìƒˆë¡œìš´ ë§Œë‚¨ì˜ ê³„ì ˆ, ì ê·¹ì ì¸ ì‚¬íšŒ í™œë™
6-8ì›”: ê¸°ì¡´ ê´€ê³„ ê¹Šì´ ìˆê²Œ ë°œì „ì‹œí‚¤ê¸°, ì—¬í–‰ì´ë‚˜ ì¶”ì–µ ë§Œë“¤ê¸°
9-11ì›”: ì§„ì§€í•œ ê´€ê³„ë¡œ ë°œì „, ë¯¸ë˜ì— ëŒ€í•œ ëŒ€í™”
12ì›”: í•œ í•´ ì •ë¦¬í•˜ë©° ê´€ê³„ ì ê²€, ìƒˆí•´ ê³„íš í•¨ê»˜ ì„¸ìš°ê¸°

**ğŸŒŸ ê³„ì ˆë³„ íŠ¹ë³„ ì „ëµ**

ë´„: ìƒˆë¡œìš´ ì‹œì‘ì˜ ì—ë„ˆì§€ë¥¼ í™œìš©í•´ ì ê·¹ì ìœ¼ë¡œ ë‹¤ê°€ê°€ì„¸ìš”
ì—¬ë¦„: í™œë™ì ì¸ ë°ì´íŠ¸ë¡œ ì¶”ì–µì„ ë§ì´ ë§Œë“œì„¸ìš”
ê°€ì„: ê¹Šì´ ìˆëŠ” ëŒ€í™”ì™€ ì§„ì§€í•œ ê´€ê³„ ë°œì „ì— ì§‘ì¤‘í•˜ì„¸ìš”
ê²¨ìš¸: ë”°ëœ»í•œ ì‹¤ë‚´ ë°ì´íŠ¸ë¡œ ì¹œë°€ê°ì„ ë†’ì´ì„¸ìš”

**ğŸ’¡ íƒ€ì´ë° í™œìš© íŒ**
1. ìƒëŒ€ë°©ì˜ ì»¨ë””ì…˜ê³¼ ê¸°ë¶„ë„ í•¨ê»˜ ê³ ë ¤í•˜ì„¸ìš”
2. ë¬´ë¦¬í•˜ê²Œ íƒ€ì´ë°ì„ ë§ì¶”ë ¤ í•˜ì§€ ë§ˆì„¸ìš”
3. ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ì„ ì¡´ì¤‘í•˜ì„¸ìš”
4. ì§ê°ë„ ì¤‘ìš”í•œ íƒ€ì´ë° ì‹ í˜¸ì…ë‹ˆë‹¤
5. ì¤€ë¹„ê°€ ë˜ì—ˆì„ ë•Œê°€ ê°€ì¥ ì¢‹ì€ íƒ€ì´ë°ì…ë‹ˆë‹¤

${name}ë‹˜ì˜ ì§„ì‹¤í•œ ë§ˆìŒê³¼ ì¢‹ì€ íƒ€ì´ë°ì´ ë§Œë‚˜ë©´ ë¶„ëª… ì›í•˜ëŠ” ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤. ì¡°ê¸‰í•´í•˜ì§€ ë§ˆì‹œê³  ìµœì ì˜ ìˆœê°„ì„ ê¸°ë‹¤ë ¤ë³´ì„¸ìš”!`;
}
function showError(msg){
  errorMessage.textContent = msg;
  errorMessage.style.display = 'block';
  setTimeout(() => {
    errorMessage.style.display = 'none';
  }, 5000);
}

// íƒ­ ê¸°ëŠ¥
document.addEventListener('DOMContentLoaded', function() {
  loadUserInfo();
  
  // í”„ë¦¬ë¯¸ì—„ ê²°ì œ ìƒíƒœ í™•ì¸
  if (localStorage.getItem('premiumPaid') === 'true') {
    document.getElementById('premiumPayment').style.display = 'none';
    document.getElementById('premiumContent').style.display = 'block';
    document.getElementById('premiumContent').classList.add('active');
  }
  
  // ë©”ì¸ íƒ­ ê¸°ëŠ¥
  const mainTabBtns = document.querySelectorAll('.main-tab-btn');
  const mainTabContents = document.querySelectorAll('.main-tab-content');
  
  mainTabBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const targetTab = this.dataset.tab;
      
      mainTabBtns.forEach(b => b.classList.remove('active'));
      mainTabContents.forEach(c => c.classList.remove('active'));
      
      this.classList.add('active');
      document.getElementById(targetTab).classList.add('active');
      
      // ì‚¬ì£¼ ê¸°ë‘¥ê³¼ ì¸ì‚¬ë§ì€ ë‚´ì‚¬ì£¼ íƒ­ì—ì„œë§Œ í‘œì‹œ
      const sajuPillars = document.getElementById('sajuPillars');
      const userGreeting = document.getElementById('userGreeting');
      
      if (targetTab === 'mysaju') {
        // ë‚´ì‚¬ì£¼ íƒ­ì—ì„œëŠ” ì €ì¥ëœ ì •ë³´ê°€ ìˆìœ¼ë©´ ì‚¬ì£¼ ê¸°ë‘¥ í‘œì‹œ
        const savedUser = localStorage.getItem('sajuUser');
        if (savedUser) {
          sajuPillars.style.display = 'grid';
          userGreeting.style.display = 'block';
        }
      } else {
        // ë‹¤ë¥¸ íƒ­ì—ì„œëŠ” ì‚¬ì£¼ ê¸°ë‘¥ê³¼ ì¸ì‚¬ë§ ìˆ¨ê¹€
        sajuPillars.style.display = 'none';
        userGreeting.style.display = 'none';
      }
    });
  });
  
  // ì„œë¸Œ íƒ­ ê¸°ëŠ¥
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('sub-tab-btn')) {
      const targetSubTab = e.target.dataset.subtab;
      const parentTab = e.target.closest('.main-tab-content');
      
      parentTab.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
      parentTab.querySelectorAll('.sub-tab-content').forEach(c => c.classList.remove('active'));
      
      e.target.classList.add('active');
      document.getElementById(targetSubTab).classList.add('active');
    }
  });
  
  // ê¶í•© ë¶„ì„ ë²„íŠ¼
  document.getElementById('compatibilityBtn').addEventListener('click', async function() {
    const partnerName = document.getElementById('partnerName').value;
    const partnerGender = document.getElementById('partnerGender').value;
    const partnerYear = parseInt(document.getElementById('partnerYear').value);
    const partnerMonth = parseInt(document.getElementById('partnerMonth').value);
    const partnerDay = parseInt(document.getElementById('partnerDay').value);
    const partnerHour = partnerTimeUnknownCheckbox.checked ? null : parseInt(document.getElementById('partnerHour').value);
    
    if (!partnerName || !partnerGender || !partnerYear || !partnerMonth || !partnerDay) {
      showError('ìƒëŒ€ë°© ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    const savedUser = JSON.parse(localStorage.getItem('sajuUser'));
    if (!savedUser) {
      showError('ë¨¼ì € ë³¸ì¸ì˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    this.disabled = true;
    this.textContent = 'ë¶„ì„ ì¤‘...';
    
    try {
      const partner = { name: partnerName, gender: partnerGender, year: partnerYear, month: partnerMonth, day: partnerDay, hour: partnerHour };
      const result = await analyzeCompatibility(savedUser, partner);
      document.getElementById('compatibilityContent').innerHTML = result.replace(/\n/g, '<br>');
    } catch (error) {
      showError('ê¶í•© ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      this.disabled = false;
      this.textContent = 'ğŸ’• ê¶í•© ë¶„ì„í•˜ê¸°';
    }
  });
  
  // ë§ˆìŒ ì½ê¸° ë²„íŠ¼ë“¤
  document.querySelectorAll('.mind-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
      const type = this.dataset.type;
      const savedUser = JSON.parse(localStorage.getItem('sajuUser'));
      
      if (!savedUser) {
        showError('ë¨¼ì € "ë‚´ì‚¬ì£¼" íƒ­ì—ì„œ ê°œì¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      this.disabled = true;
      const originalText = this.textContent;
      this.textContent = 'ë¶„ì„ ì¤‘...';
      
      try {
        const saju = calculateSaju(savedUser.year, savedUser.month, savedUser.day, savedUser.hour);
        const result = await analyzeMindReading(savedUser.name, savedUser.gender, saju, type);
        document.getElementById('mindContent').innerHTML = result.replace(/\n/g, '<br>');
      } catch (error) {
        showError('ë§ˆìŒ ì½ê¸° ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        this.disabled = false;
        this.textContent = originalText;
      }
    });
  });
  
  // ì—°ì• ìš´ ë¶„ì„ ë²„íŠ¼ë“¤
  document.getElementById('dailyAnalyzeBtn').addEventListener('click', async function() {
    await analyzeLoveFortuneByType('daily', this, 'dailyContent');
  });
  
  document.getElementById('monthlyAnalyzeBtn').addEventListener('click', async function() {
    await analyzeLoveFortuneByType('monthly', this, 'monthlyContent');
  });
  
  document.getElementById('yearlyAnalyzeBtn').addEventListener('click', async function() {
    await analyzeLoveFortuneByType('yearly', this, 'yearlyContent');
  });
  
  // í”„ë¦¬ë¯¸ì—„ ê²°ì œ ë²„íŠ¼
  document.getElementById('premiumPayBtn').addEventListener('click', function() {
    // ì‹¤ì œë¡œëŠ” ê²°ì œ ì‹œìŠ¤í…œê³¼ ì—°ë™
    if (confirm('í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ë¥¼ ê²°ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (â‚©19,900)')) {
      localStorage.setItem('premiumPaid', 'true');
      document.getElementById('premiumPayment').style.display = 'none';
      document.getElementById('premiumContent').style.display = 'block';
      document.getElementById('premiumContent').classList.add('active');
      
      // ì‚¬ìš©ì ì •ë³´ê°€ ìˆìœ¼ë©´ ë²„íŠ¼ë“¤ í™œì„±í™”
      const savedUser = localStorage.getItem('sajuUser');
      if (savedUser) {
        updateTabsBasedOnUserInfo(JSON.parse(savedUser));
      }
      
      alert('í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ëª¨ë“  ê³ ê¸‰ ë¶„ì„ì„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    }
  });
  
  // í”„ë¦¬ë¯¸ì—„ ë¶„ì„ ë²„íŠ¼ë“¤
  document.getElementById('futureAnalyzeBtn').addEventListener('click', async function() {
    await analyzePremiumContent('future', this, 'futureContent', analyzeFuture);
  });
  
  document.getElementById('thinkingAnalyzeBtn').addEventListener('click', async function() {
    await analyzePremiumContent('thinking', this, 'thinkingContent', analyzeThinking);
  });
  
  document.getElementById('marriageAnalyzeBtn').addEventListener('click', async function() {
    await analyzePremiumContent('marriage', this, 'marriageContent', analyzeMarriage);
  });
  
  document.getElementById('strategyAnalyzeBtn').addEventListener('click', async function() {
    await analyzePremiumContent('strategy', this, 'strategyContent', analyzeStrategy);
  });
  
  document.getElementById('soulmateAnalyzeBtn').addEventListener('click', async function() {
    await analyzePremiumContent('soulmate', this, 'soulmateContent', analyzeSoulmate);
  });
  
  document.getElementById('timingAnalyzeBtn').addEventListener('click', async function() {
    await analyzePremiumContent('timing', this, 'timingContent', analyzeTiming);
  });
});

// í”„ë¦¬ë¯¸ì—„ ì»¨í…ì¸  ë¶„ì„ í•¨ìˆ˜
async function analyzePremiumContent(type, button, contentId, analyzeFunction) {
  const savedUser = JSON.parse(localStorage.getItem('sajuUser'));
  
  if (!savedUser) {
    showError('ë¨¼ì € "ë‚´ì‚¬ì£¼" íƒ­ì—ì„œ ê°œì¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  button.disabled = true;
  const originalText = button.textContent;
  button.textContent = 'ë¶„ì„ ì¤‘...';
  
  try {
    const saju = calculateSaju(savedUser.year, savedUser.month, savedUser.day, savedUser.hour);
    const result = await analyzeFunction(savedUser.name, savedUser.gender, saju);
    document.getElementById(contentId).innerHTML = result.replace(/\n/g, '<br>');
  } catch (error) {
    showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  } finally {
    button.disabled = false;
    button.textContent = originalText;
  }
}

// ì—°ì• ìš´ ë¶„ì„ í•¨ìˆ˜
async function analyzeLoveFortuneDirectly(type, button, contentId) {
  button.disabled = true;
  const originalText = button.textContent;
  button.textContent = 'ë¶„ì„ ì¤‘...';
  
  try {
    // ê¸°ë³¸ ì‚¬ì£¼ ì •ë³´ë¡œ ë¶„ì„ (ê°œì¸ ì •ë³´ ì…ë ¥ ë¶ˆí•„ìš”)
    const defaultSaju = { year: 'ê°‘ì', month: 'ì •ì¶•', day: 'ë¬´ì¸', time: 'ê³„í•´' };
    const result = await analyzeLoveFortune('íšŒì›', 'female', defaultSaju, type);
    document.getElementById(contentId).innerHTML = result.replace(/\n/g, '<br>');
  } catch (error) {
    showError('ì—°ì• ìš´ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  } finally {
    button.disabled = false;
    button.textContent = originalText;
  }
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const name = document.getElementById('name').value.trim();
  const gender = document.getElementById('gender').value;
  const year = parseInt(document.getElementById('year').value, 10);
  const month = parseInt(document.getElementById('month').value, 10);
  const day = parseInt(document.getElementById('day').value, 10);
  const hour = timeUnknownCheckbox.checked ? null : parseInt(document.getElementById('hour').value, 10);

  if (!name || !gender || Number.isNaN(year) || Number.isNaN(month) || Number.isNaN(day)) {
    showError('ëª¨ë“  ì •ë³´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (!timeUnknownCheckbox.checked && Number.isNaN(hour)) {
    showError('íƒœì–´ë‚œ ì‹œê°„ì„ ì„ íƒí•˜ê±°ë‚˜ "ì‹œê°„ì„ ëª¨ë¦„"ì„ ì²´í¬í•´ì£¼ì„¸ìš”.');
    return;
  }

  // ì‚¬ìš©ì ì •ë³´ ì €ì¥
  saveUserInfo(name, gender, year, month, day, hour);

  analyzeBtn.disabled = true;
  loading.style.display = 'block';
  errorMessage.style.display = 'none';

  try {
    const saju = calculateSaju(year, month, day, hour);
    
    // ì‚¬ì£¼ í‘œì‹œ (ë‚´ì‚¬ì£¼ íƒ­ì—ì„œë§Œ)
    document.getElementById('sajuPillars').style.display = 'grid';
    document.getElementById('yearPillar').textContent = saju.year;
    document.getElementById('monthPillar').textContent = saju.month;
    document.getElementById('dayPillar').textContent = saju.day;
    document.getElementById('timePillar').textContent = saju.time;
    
    // ì‚¬ìš©ì ì¸ì‚¬ë§
    document.getElementById('userGreeting').style.display = 'block';
    document.getElementById('userGreeting').textContent = `ğŸ’– ${name}ë‹˜ì˜ ì‚¬ì£¼ ë¶„ì„ ğŸ’–`;
    
    // ë‚´ì‚¬ì£¼ ë¶„ì„ ì‹¤í–‰
    const basicResult = await analyzeBasicPersonality(name, gender, saju);
    document.getElementById('basicContent').innerHTML = basicResult.replace(/\n/g, '<br>');
    
    const careerResult = await analyzeCareer(name, gender, saju);
    document.getElementById('careerContent').innerHTML = careerResult.replace(/\n/g, '<br>');
    
    // ë¡œë”© ìˆ¨ê¸°ê³  ê²°ê³¼ í‘œì‹œ
    loading.style.display = 'none';
    
  } catch (err) {
    console.error('ë¶„ì„ ì˜¤ë¥˜:', err);
    loading.style.display = 'none';
    showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
  } finally {
    analyzeBtn.disabled = false;
  }
});